# 微信小程序动态导入问题修复说明

## 问题描述

在微信小程序开发中，使用ES6动态导入（`await import()`）时遇到以下错误：

```
Failed to load module script: Expected a JavaScript module script but the server responded with a MIME type of "". 
Strict MIME type checking is enforced for module scripts per HTML spec.
```

## 错误原因

1. **微信小程序限制**：微信小程序对动态导入有严格限制，不支持相对路径的动态导入
2. **MIME类型问题**：开发工具无法正确处理动态导入的模块
3. **路径解析问题**：动态导入的路径在运行时可能解析不正确

## 解决方案

### 方案一：静态导入 + 工厂模式（推荐）

**修改前（动态导入）：**
```javascript
// GambleEditorConfig.js
async importStore(gambleType) {
    const config = this.getEditorConfig(gambleType);
    try {
        const module = await import(config.storePath);
        return module.default || module[Object.keys(module)[0]];
    } catch (error) {
        throw new Error(`无法加载游戏类型 ${gambleType} 的Store`);
    }
}
```

**修改后（静态导入）：**
```javascript
// GambleEditorConfig.js
// 静态导入所有Store类
import { Gamble4PLasiStore } from '../stores/gamble/4p/4p-lasi/Gamble4PLasiStore.js'
import { NewG48421Store } from '../stores/gamble/4p/4p-8421/new_gamble_4P_8421_Store.js'

const GAMBLE_EDITOR_CONFIGS = {
    '4p-lasi': {
        humanName: '四人拉丝',
        storeClass: Gamble4PLasiStore, // 直接引用Store类
        // ... 其他配置
    },
    '4p-8421': {
        humanName: '四人8421',
        storeClass: NewG48421Store, // 直接引用Store类
        // ... 其他配置
    }
};

// 获取Store类（静态方式）
getStoreClass(gambleType) {
    const config = this.getEditorConfig(gambleType);
    if (!config) {
        throw new Error(`不支持的游戏类型: ${gambleType}`);
    }
    return config.storeClass;
}
```

**使用方式修改：**
```javascript
// 修改前
const StoreClass = await GambleEditorConfig.importStore(gambleType)

// 修改后
const StoreClass = GambleEditorConfig.getStoreClass(gambleType)
```

### 方案二：条件导入（备选）

如果Store文件较多，可以使用条件导入：

```javascript
// 条件导入方式
function getStoreClass(gambleType) {
    switch (gambleType) {
        case '4p-lasi':
            return require('../stores/gamble/4p/4p-lasi/Gamble4PLasiStore.js').Gamble4PLasiStore;
        case '4p-8421':
            return require('../stores/gamble/4p/4p-8421/new_gamble_4P_8421_Store.js').NewG48421Store;
        default:
            throw new Error(`不支持的游戏类型: ${gambleType}`);
    }
}
```

## 优势

1. **兼容性好**：静态导入在微信小程序中完全支持
2. **性能更好**：避免了动态导入的开销
3. **类型安全**：编译时就能发现导入错误
4. **调试友好**：错误信息更清晰

## 注意事项

1. **包体积**：静态导入会增加初始包体积，但微信小程序支持分包加载
2. **维护性**：新增Store类型时需要手动添加导入语句
3. **Tree Shaking**：静态导入有利于代码压缩和优化

## 测试验证

修复后，可以通过以下方式验证：

1. 在微信开发者工具中打开项目
2. 进入规则编辑页面
3. 选择不同的游戏类型
4. 确认Store正确加载，无动态导入错误

## 相关文件

- `utils/GambleEditorConfig.js` - 主要修改文件
- `pages/rules/RuleEditer/RuleEditer.js` - 使用方式修改
- `stores/gamble/4p/4p-lasi/Gamble4PLasiStore.js` - 4p-lasi Store
- `stores/gamble/4p/4p-8421/new_gamble_4P_8421_Store.js` - 4p-8421 Store
