# 连锁设置倍数功能说明

## 功能概述

连锁设置倍数功能是踢一脚功能的一个重要特性，允许用户通过点击球洞来设置倍数，并自动将倍数应用到从该洞开始到最后一个洞的所有洞。

## 功能特点

### 1. 连锁设置
- 点击任意球洞设置倍数后，从该洞开始到最后一个洞都会应用相同的倍数
- 支持多次设置，每次设置都会覆盖从选择洞开始到最后的倍数

### 2. 多次设置
- 可以点击不同洞设置不同倍数
- 新设置的倍数只会影响从该洞开始到最后的洞
- 前面的洞的倍数设置保持不变

### 3. 实时显示
- 在洞选择界面实时显示每个洞的当前倍数配置
- 倍数显示在洞号圆圈下方，格式为 "X倍数"

### 4. 数据持久化
- 倍数设置会保存到 `runtimeMultipliers` 中
- 与游戏配置关联，确保数据一致性

## 使用流程

### 步骤 1: 进入踢一脚功能
1. 在游戏详情页面找到踢一脚功能
2. 点击进入踢一脚配置页面

### 步骤 2: 选择球洞
1. 在洞选择界面中，点击任意球洞
2. 系统会弹出倍数选择器

### 步骤 3: 设置倍数
1. 在倍数选择器中选择合适的倍数
2. 点击确认，系统会自动应用倍数到从该洞开始到最后的洞
3. 界面会实时更新显示新的倍数配置

### 步骤 4: 多次设置（可选）
1. 可以继续点击其他洞设置新的倍数
2. 新倍数只会影响从该洞开始到最后的洞
3. 前面的洞的倍数设置保持不变

### 步骤 5: 确认配置
1. 完成所有倍数设置后，点击确定按钮
2. 系统会保存所有倍数配置到游戏数据中

## 技术实现

### 核心方法

#### onMultiplierConfirm
```javascript
onMultiplierConfirm(e) {
    const { hindex, multiplier } = e.detail;
    
    // 获取当前洞在洞序列表中的索引
    const currentHoleIndex = this.data.holePlayList.findIndex(hole => 
        String(hole.hindex) === String(hindex)
    );
    
    // 从当前洞开始到最后一个洞，设置相同的倍数
    for (let i = currentHoleIndex; i < this.data.holePlayList.length; i++) {
        const targetHole = this.data.holePlayList[i];
        const targetHindex = targetHole.hindex;
        
        // 更新或新增倍数配置
        this.updateHoleMultiplier(targetHindex, multiplier);
    }
}
```

### 数据结构

#### runtimeMultipliers
```javascript
[
  {
    runtime_id: "config_id",  // 配置项ID
    holeMultipliers: [
      {
        hindex: 1,        // 洞号
        multiplier: 2     // 倍数
      },
      {
        hindex: 3,
        multiplier: 4
      }
    ]
  }
]
```

#### holeMultiplierMap
```javascript
{
  "1": 2,  // 洞号1的倍数为2
  "3": 4,  // 洞号3的倍数为4
  "5": 4   // 洞号5的倍数为4（连锁设置）
}
```

## 界面显示

### 洞选择界面
- 每个洞显示为一个圆形按钮
- 洞号显示在圆圈中央
- 当前倍数显示在圆圈下方，格式为 "X倍数"
- 没有设置倍数的洞不显示倍数文本

### 倍数选择器
- 提供预设倍数选项（1、2、3、4、5等）
- 支持自定义输入倍数
- 显示当前选择的洞号和洞名

## 注意事项

1. **倍数范围**：倍数通常为1-10之间的整数或小数
2. **数据同步**：倍数设置会实时同步到 `gameStore` 中
3. **配置关联**：倍数配置与特定的运行时配置项关联
4. **界面更新**：设置倍数后界面会立即更新显示
5. **数据验证**：系统会验证倍数的有效性

## 常见问题

### Q: 如何清除某个洞的倍数设置？
A: 目前不支持单独清除某个洞的倍数设置。如果需要清除，可以重新设置该洞的倍数为1。

### Q: 倍数设置会影响哪些功能？
A: 倍数设置主要影响踢一脚功能的计算，不会影响其他游戏功能。

### Q: 倍数设置会保存多久？
A: 倍数设置会保存到游戏数据中，直到游戏结束或手动清除。

### Q: 可以设置小数倍数吗？
A: 是的，支持设置小数倍数，如1.5、2.5等。

## 更新日志

### 2024-12-19
- ✅ 实现连锁设置倍数功能
- ✅ 支持多次设置不同倍数区间
- ✅ 实时显示倍数配置
- ✅ 数据持久化保存
- ✅ 优化用户交互体验 