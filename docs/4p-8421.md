# R4P8421 组件

## 功能描述
R4P8421 是一个用于显示4人游戏规则的自定义组件，专门用于展示8421规则类型的游戏规则。组件能够自动解析和展示详细的配置信息，包括扣分、吃肉、顶洞等配置。

## 组件结构
```
Rule4P8421/
├── Rule4P8421.js      # 组件逻辑
├── Rule4P8421.json    # 组件配置
├── Rule4P8421.wxml    # 组件模板
├── Rule4P8421.wxss    # 组件样式
└── README.md          # 说明文档
```

## 使用方法

### 1. 在页面中注册组件
在页面的 `.json` 文件中添加组件引用：
```json
{
  "usingComponents": {
    "R4P8421": "/components/RuleCard/4p/4p-8421/Rule4P8421"
  }
}
```

### 2. 在模板中使用组件
```xml
<R4P8421 
  item="{{ ruleItem }}" 
  bind:editRule="onEditRule"
  bind:viewRule="onViewRule"
  bind:longPressRule="onLongPressRule"
/>
```

### 3. 组件属性

| 属性名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| item | Object | 是 | 规则数据对象 |

### 4. 组件事件

| 事件名 | 说明 | 回调参数 |
|--------|------|----------|
| editRule | 编辑规则 | { item, group, id } |
| viewRule | 查看规则 | { item, group, id } |
| longPressRule | 长按规则 | { item, group, id } |

### 5. 规则数据格式
```javascript
{
  userRuleId: "规则ID",
  gambleSysName: "系统规则名称",
  gambleUserName: "用户规则名称", 
  user_rulename: "规则名称",
  title: "标题",
  description: "规则描述",
  created_at: "创建时间",
  createTime: "创建时间",
  
  // 配置相关字段
  sub8421_config_string: "Par+4",           // 扣分配置
  max8421_sub_value: 2,                     // 扣分封顶值
  duty_config: "NODUTY",                    // 同伴惩罚配置
  meat_value_config_string: "MEAT_AS_1",    // 吃肉分值配置 (支持MEAT_AS_X格式，X为1-5)
  meat_max_value: 3,                        // 吃肉封顶值
  eating_range: [                           // 吃肉数量配置
    { label: '帕以上', value: 1 },
    { label: '帕', value: 2 },
    { label: '鸟', value: 3 },
    { label: '鸟以下', value: 1 }
  ],
  draw8421_config: "DrawEqual"              // 顶洞配置
}
```

## 配置解析功能

### 显示格式
组件会将配置信息分为三行显示，每行都有对应的标签：

```
扣分：从帕+4开始扣分，扣2分封顶，不包负分
吃肉：帕以上1个、帕2个、鸟3个、鸟以下1个，肉算1分，3分封顶
顶洞：得分打平
```

### 扣分配置解析
组件会自动解析以下扣分相关配置：
- **扣分开始条件**：从帕+X开始扣分、从双帕+Y开始扣分、不扣分
- **封顶条件**：扣X分封顶、不封顶（10000000显示为"不封顶"）
- **同伴惩罚**：不包负分、同伴顶头包负分、包负分

**示例输出**：
```
扣分：从帕+4开始扣分，扣2分封顶，不包负分
```

### 吃肉配置解析
组件会自动解析以下吃肉相关配置：
- **吃肉数量**：帕以上X个、鸟Y个、帕Z个、鸟以下W个（支持JSON字符串格式）
- **分值计算**：肉算X分（X为1-5）、分值翻倍、分值连续翻倍
- **封顶条件**：X分封顶、不封顶（10000000显示为"不封顶"）

**数据格式**：
```javascript
// eating_range 可以是JSON字符串或对象
eating_range: "{\"BetterThanBirdie\":2,\"Birdie\":2,\"Par\":1,\"WorseThanPar\":0}"
// 或者
eating_range: {
  "BetterThanBirdie": 2,  // 帕以上2个
  "Birdie": 2,           // 鸟2个
  "Par": 1,              // 帕1个
  "WorseThanPar": 0      // 鸟以下0个
}

// meat_value_config_string 支持以下格式：
// "MEAT_AS_1" - 肉算1分
// "MEAT_AS_2" - 肉算2分
// "MEAT_AS_3" - 肉算3分
// "MEAT_AS_4" - 肉算4分
// "MEAT_AS_5" - 肉算5分
// "SINGLE_DOUBLE" - 分值翻倍
// "CONTINUE_DOUBLE" - 分值连续翻倍
```

**示例输出**：
```
吃肉：帕以上2个、鸟2个、帕1个、鸟以下0个，肉算3分，3分封顶
```

### 顶洞配置解析
组件会自动解析以下顶洞相关配置：
- **顶洞条件**：得分打平、得分X分以内、无顶洞

**示例输出**：
```
顶洞：得分打平
```

## 配置数据示例

### 完整配置示例
```javascript
{
  gambleUserName: "我的8421规则",
  sub8421_config_string: "Par+4",
  max8421_sub_value: 2,
  duty_config: "NODUTY",
  meat_value_config_string: "MEAT_AS_3",    // 肉算3分
  meat_max_value: 3,
  eating_range: "{\"BetterThanBirdie\":2,\"Birdie\":2,\"Par\":1,\"WorseThanPar\":0}",
  draw8421_config: "DrawEqual"
}
```

**显示效果**：
```
我的8421规则
扣分：从帕+4开始扣分，扣2分封顶，不包负分
吃肉：帕以上2个、鸟2个、帕1个、鸟以下0个，肉算3分，3分封顶
顶洞：得分打平
```

### 简化配置示例
```javascript
{
  gambleUserName: "简单8421规则",
  sub8421_config_string: "NoSub",
  draw8421_config: "NoDraw"
}
```

**显示效果**：
```
简单8421规则
扣分：不扣分
吃肉：无
顶洞：无顶洞
```

## 样式说明
组件使用独立的样式文件，包含：
- 规则卡片容器样式（绿色背景、圆角、阴影）
- 规则头部样式（标题和类型标签）
- 配置详情样式（多行配置信息）
- 规则底部样式（时间和操作按钮）

## 注意事项
1. 组件会自动处理数据为空的情况
2. 事件会向上传递给父组件处理
3. 组件支持点击、长按等交互操作
4. 样式采用响应式设计，适配不同屏幕尺寸
5. 配置解析支持多种数据格式的兼容性处理
6. 组件会自动监听item属性变化并重新解析配置

## 调试信息
组件会在控制台输出调试信息：
- `🎯 [R4P8421] 组件已加载, item: xxx`
- `🎯 [R4P8421] 组件已准备就绪`
- `🎯 [R4P8421] item数据变化: xxx`
- `🎯 [R4P8421] 解析的配置详情: xxx`
- `🎯 [R4P8421] 编辑规则: xxx`
- `🎯 [R4P8421] 查看规则: xxx`
- `🎯 [R4P8421] 长按规则: xxx` 