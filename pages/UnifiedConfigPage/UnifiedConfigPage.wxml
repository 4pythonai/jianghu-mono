<!-- 
  UnifiedConfigPage.wxml
  统一规则配置页面模板
  基于模式驱动的组件渲染系统
-->

<view class="unified-config-page">
  <!-- 🔖 页面头部信息 -->
  <view class="page-header">
    <text class="page-title">{{gameName}} - 规则配置</text>
    <text class="page-mode" wx:if="{{mode === 'add'}}">新建规则</text>
    <text class="page-mode" wx:elif="{{mode === 'edit'}}">编辑规则</text>
    <text class="page-mode" wx:elif="{{mode === 'system-add'}}">系统规则配置</text>
  </view>

  <!-- 📇 基础配置区 -->
  <view class="config-section base-config">
    <view class="section-header">
      <text class="section-title">基础信息</text>
    </view>

    <view class="config-item">
      <text class="config-label">规则名称*</text>
      <input
        class="config-input rule-name-input"
        value="{{ruleName}}"
        bindinput="onRuleNameInput"
        placeholder="请输入规则名称(至少2个字符)"
        maxlength="20"
      />
    </view>
  </view>

  <!-- ⚙️ 组件配置区 -->
  <view class="config-section components-config" wx:if="{{isInitialized}}">
    <view class="section-header">
      <text class="section-title">详细配置</text>
    </view>

    <!-- 动态组件渲染容器 -->
    <view class="components-container">
      <block wx:for="{{configComponents}}" wx:key="name">
        <view class="component-wrapper">
          <view class="component-title-bar">
            <text class="component-title">{{item.title}}</text>
            <view class="required-badge" wx:if="{{item.required}}">必填</view>
          </view>

          <view class="component-content">
            <!-- 拉丝配置 -->
            <LasiBaoDong
              wx:if="{{item.name === 'LasiBaoDong'}}"
              id="LasiBaoDong"
              bind:configChange="onComponentConfigChange"
            />

            <LasiKPI
              wx:if="{{item.name === 'LasiKPI'}}"
              id="LasiKPI"
              bind:configChange="onComponentConfigChange"
            />

            <LasiRewardConfig
              wx:if="{{item.name === 'LasiRewardConfig'}}"
              id="LasiRewardConfig"
              bind:configChange="onComponentConfigChange"
            />

            <LasiEatmeat
              wx:if="{{item.name === 'LasiEatmeat'}}"
              id="LasiEatmeat"
              bind:configChange="onComponentConfigChange"
            />

            <LasiDingDong
              wx:if="{{item.name === 'LasiDingDong'}}"
              id="LasiDingDong"
              bind:configChange="onComponentConfigChange"
            />

            <!-- 8421配置 -->
            <E8421Koufen
              wx:if="{{item.name === 'E8421Koufen'}}"
              id="E8421Koufen"
              bind:configChange="onComponentConfigChange"
            />

            <Draw8421
              wx:if="{{item.name === 'Draw8421'}}"
              id="Draw8421"
              bind:configChange="onComponentConfigChange"
            />

            <E8421Meat
              wx:if="{{item.name === 'E8421Meat'}}"
              id="E8421Meat"
              bind:configChange="onComponentConfigChange"
            />
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- 🏗️ 加载状态骨架屏 -->
  <view class="loading-container" wx:elif="{{!isInitialized}}">
    <view class="loading-animation">
      <text class="loading-text">🎪 正在加载配置组件...</text>
    </view>
  </view>

  <!-- 🚨 空状态提示 -->
  <view class="empty-container" wx:if="{{isInitialized && configComponents.length === 0}}">
    <text class="empty-text">未找到可用的配置组件</text>
    <text class="empty-desc">请检查游戏类型是否正确：{{gameType}}</text>
  </view>
</view>

<!-- 🎯 操作按钮浮动层 -->
<view class="action-bar">
  <button class="cancel-btn" bindtap="onCancel">
    <text class="btn-text">取消</text>
  </button>
  <button
    class="save-btn"
    bindtap="onSaveRule"
    loading="{{saving}}"
    disabled="{{saving || !ruleName || ruleName.length < 2}}"
  >
    <text class="btn-text">{{saving ? '保存中...' : (mode === 'edit' ? '更新规则' : '保存规则')}}</text>
  </button>
</view>

<!-- 📚 调试信息面板（生产环境可隐藏） -->
<view class="debug-panel" wx:if="{{false}}">
  <view class="debug-item">
    <text class="debug-label">Current Mode:</text>
    <text class="debug-value">{{mode}}</text>
  </view>
  <view class="debug-item">
    <text class="debug-label">Game Type:</text>
    <text class="debug-value">{{gameType}}</text>
  </view>
  <view class="debug-item">
    <text class="debug-label">Components:</text>
    <text class="debug-value">{{configComponents.length}}</text>
  </view>
  <view class="debug-item">
    <text class="debug-label">Rule Name:</text>
    <text class="debug-value">{{ruleName || '-'}}</text>
  </view>
</view>
