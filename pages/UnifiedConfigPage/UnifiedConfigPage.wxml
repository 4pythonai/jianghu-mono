<!-- 
  UnifiedConfigPage.wxml
  ç»Ÿä¸€è§„åˆ™é…ç½®é¡µé¢æ¨¡æ¿
  åŸºäºæ¨¡å¼é©±åŠ¨çš„ç»„ä»¶æ¸²æŸ“ç³»ç»Ÿ
-->

<view class="unified-config-page">
  <!-- ğŸ”– é¡µé¢å¤´éƒ¨ä¿¡æ¯ -->
  <view class="page-header">
    <text class="page-title">{{gameName}} - è§„åˆ™é…ç½®</text>
    <text class="page-mode" wx:if="{{mode === 'add'}}">æ–°å»ºè§„åˆ™</text>
    <text class="page-mode" wx:elif="{{mode === 'edit'}}">ç¼–è¾‘è§„åˆ™</text>
    <text class="page-mode" wx:elif="{{mode === 'system-add'}}">ç³»ç»Ÿè§„åˆ™é…ç½®</text>
  </view>

  <!-- ğŸ“‡ åŸºç¡€é…ç½®åŒº -->
  <view class="config-section base-config">
    <view class="section-header">
      <text class="section-title">åŸºç¡€ä¿¡æ¯</text>
    </view>

    <view class="config-item">
      <text class="config-label">è§„åˆ™åç§°*</text>
      <input
        class="config-input rule-name-input"
        value="{{ruleName}}"
        bindinput="onRuleNameInput"
        placeholder="è¯·è¾“å…¥è§„åˆ™åç§°(è‡³å°‘2ä¸ªå­—ç¬¦)"
        maxlength="20"
      />
    </view>
  </view>

  <!-- âš™ï¸ ç»„ä»¶é…ç½®åŒº -->
  <view class="config-section components-config" wx:if="{{isInitialized}}">
    <view class="section-header">
      <text class="section-title">è¯¦ç»†é…ç½®</text>
    </view>

    <!-- åŠ¨æ€ç»„ä»¶æ¸²æŸ“å®¹å™¨ -->
    <view class="components-container">
      <block wx:for="{{configComponents}}" wx:key="name">
        <view class="component-wrapper">
          <view class="component-title-bar">
            <text class="component-title">{{item.title}}</text>
            <view class="required-badge" wx:if="{{item.required}}">å¿…å¡«</view>
          </view>

          <view class="component-content">
            <!-- æ‹‰ä¸é…ç½® -->
            <LasiBaoDong
              wx:if="{{item.name === 'LasiBaoDong'}}"
              id="LasiBaoDong"
              bind:configChange="onComponentConfigChange"
            />

            <LasiKPI
              wx:if="{{item.name === 'LasiKPI'}}"
              id="LasiKPI"
              bind:configChange="onComponentConfigChange"
            />

            <LasiRewardConfig
              wx:if="{{item.name === 'LasiRewardConfig'}}"
              id="LasiRewardConfig"
              bind:configChange="onComponentConfigChange"
            />

            <LasiEatmeat
              wx:if="{{item.name === 'LasiEatmeat'}}"
              id="LasiEatmeat"
              bind:configChange="onComponentConfigChange"
            />

            <LasiDingDong
              wx:if="{{item.name === 'LasiDingDong'}}"
              id="LasiDingDong"
              bind:configChange="onComponentConfigChange"
            />

            <!-- 8421é…ç½® -->
            <E8421Koufen
              wx:if="{{item.name === 'E8421Koufen'}}"
              id="E8421Koufen"
              bind:configChange="onComponentConfigChange"
            />

            <Draw8421
              wx:if="{{item.name === 'Draw8421'}}"
              id="Draw8421"
              bind:configChange="onComponentConfigChange"
            />

            <E8421Meat
              wx:if="{{item.name === 'E8421Meat'}}"
              id="E8421Meat"
              bind:configChange="onComponentConfigChange"
            />
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- ğŸ—ï¸ åŠ è½½çŠ¶æ€éª¨æ¶å± -->
  <view class="loading-container" wx:elif="{{!isInitialized}}">
    <view class="loading-animation">
      <text class="loading-text">ğŸª æ­£åœ¨åŠ è½½é…ç½®ç»„ä»¶...</text>
    </view>
  </view>

  <!-- ğŸš¨ ç©ºçŠ¶æ€æç¤º -->
  <view class="empty-container" wx:if="{{isInitialized && configComponents.length === 0}}">
    <text class="empty-text">æœªæ‰¾åˆ°å¯ç”¨çš„é…ç½®ç»„ä»¶</text>
    <text class="empty-desc">è¯·æ£€æŸ¥æ¸¸æˆç±»å‹æ˜¯å¦æ­£ç¡®ï¼š{{gameType}}</text>
  </view>
</view>

<!-- ğŸ¯ æ“ä½œæŒ‰é’®æµ®åŠ¨å±‚ -->
<view class="action-bar">
  <button class="cancel-btn" bindtap="onCancel">
    <text class="btn-text">å–æ¶ˆ</text>
  </button>
  <button
    class="save-btn"
    bindtap="onSaveRule"
    loading="{{saving}}"
    disabled="{{saving || !ruleName || ruleName.length < 2}}"
  >
    <text class="btn-text">{{saving ? 'ä¿å­˜ä¸­...' : (mode === 'edit' ? 'æ›´æ–°è§„åˆ™' : 'ä¿å­˜è§„åˆ™')}}</text>
  </button>
</view>

<!-- ğŸ“š è°ƒè¯•ä¿¡æ¯é¢æ¿ï¼ˆç”Ÿäº§ç¯å¢ƒå¯éšè—ï¼‰ -->
<view class="debug-panel" wx:if="{{false}}">
  <view class="debug-item">
    <text class="debug-label">Current Mode:</text>
    <text class="debug-value">{{mode}}</text>
  </view>
  <view class="debug-item">
    <text class="debug-label">Game Type:</text>
    <text class="debug-value">{{gameType}}</text>
  </view>
  <view class="debug-item">
    <text class="debug-label">Components:</text>
    <text class="debug-value">{{configComponents.length}}</text>
  </view>
  <view class="debug-item">
    <text class="debug-label">Rule Name:</text>
    <text class="debug-value">{{ruleName || '-'}}</text>
  </view>
</view>
