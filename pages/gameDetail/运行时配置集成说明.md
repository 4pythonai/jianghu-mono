# GameDetail 运行时配置集成说明

## 功能概述

在 `pages/gameDetail/gameDetail` 页面中集成了根据 `gameid` 获取所有游戏运行时配置(`listRuntimeConfig`)的功能。

## 实现方案

### 1. 数据存储层 (`stores/gameStore.js`)

#### 新增状态字段:
- `runtimeConfigs: []` - 运行时配置列表
- `loadingRuntimeConfig: false` - 加载运行时配置状态
- `runtimeConfigError: null` - 运行时配置错误信息

#### 新增方法:
- `fetchRuntimeConfigs(gameId)` - 获取运行时配置的异步方法

#### 集成逻辑:
- 在 `fetchGameDetail` 方法中自动调用 `fetchRuntimeConfigs`
- 确保游戏详情和运行时配置并行加载

### 2. 页面控制层 (`pages/gameDetail/gameDetail.js`)

#### 新增绑定字段:
```javascript
fields: [
    // ... 原有字段
    'runtimeConfigs', 
    'loadingRuntimeConfig', 
    'runtimeConfigError'
]
```

#### 新增绑定方法:
```javascript
actions: [
    // ... 原有方法
    'fetchRuntimeConfigs'
]
```

#### 新增页面方法:
- `checkRuntimeConfigStatus()` - 检查运行时配置状态
- `retryLoadRuntimeConfig()` - 重试加载运行时配置
- 修改 `retryLoad()` - 同时重试游戏详情和运行时配置

### 3. 页面展示层 (`pages/gameDetail/gameDetail.wxml`)

#### 新增显示区域:
- 在"游戏"选项卡中添加运行时配置显示区域
- 包含四种状态的处理:
  - 加载中状态
  - 错误状态(带重试按钮)
  - 配置列表显示
  - 空状态显示

#### 配置信息展示:
- 配置索引
- 创建时间
- 规则类型
- 状态信息
- 玩家数量(如果有)

### 4. 样式层 (`pages/gameDetail/gameDetail.wxss`)

#### 新增样式类:
- `.runtime-config-section` - 配置区域容器
- `.loading-state` - 加载状态样式
- `.error-state` - 错误状态样式
- `.config-list` - 配置列表样式
- `.config-item` - 单个配置项样式
- `.empty-state` - 空状态样式

## 使用流程

### 自动加载流程:
1. 页面进入时调用 `fetchGameDetail(gameId)`
2. 游戏详情加载成功后自动调用 `fetchRuntimeConfigs(gameId)`
3. 运行时配置异步加载, 不影响游戏详情展示
4. 加载完成后在"游戏"选项卡中展示配置信息

### 错误处理流程:
1. 运行时配置加载失败时显示错误信息
2. 用户可点击"重试"按钮重新加载
3. 页面重试时同时重试游戏详情和运行时配置

## API 调用

### 调用的接口:
- `gambleApi.listRuntimeConfig(params, options)`

### 请求参数:
```javascript
{
    gameid: gameId  // 游戏ID
}
```

### 请求选项:
```javascript
{
    loadingTitle: '加载游戏配置...',
    loadingMask: false  // 不显示遮罩, 避免影响用户体验
}
```

## 日志记录

### 日志标记:
- `🎮 [Store]` - Store 层的运行时配置相关日志
- `🎮 [GameDetail]` - 页面层的运行时配置相关日志

### 关键日志点:
- 开始获取运行时配置
- API 响应处理
- 加载成功/失败状态
- 配置数据统计

## 状态管理

### 状态流转:
```
初始状态 → 加载中 → 成功/失败
    ↓         ↓        ↓
   空状态   加载提示   数据展示/错误提示
```

### 状态优先级:
1. 加载中状态(最高优先级)
2. 错误状态(有错误且非加载中)
3. 数据展示(有数据且非加载中)
4. 空状态(无数据、非加载中、无错误)

## 兼容性考虑

### 降级处理:
- API 调用失败时不影响游戏详情的正常展示
- 运行时配置为增强功能, 不影响核心计分功能
- 错误状态下提供重试机制

### 数据校验:
- 对 API 返回的数据进行安全性检查
- 处理空数据、异常数据的情况
- 确保页面在各种数据状态下都能正常展示

## 测试要点

### 功能测试:
- [ ] 页面进入时自动加载运行时配置
- [ ] 配置加载成功时正确显示
- [ ] 配置加载失败时显示错误信息
- [ ] 重试功能正常工作
- [ ] 空配置状态正常显示

### 性能测试:
- [ ] 运行时配置加载不影响游戏详情显示
- [ ] 并行加载提升用户体验
- [ ] 网络异常时的处理

### 兼容性测试:
- [ ] 不同游戏ID的配置获取
- [ ] API 返回异常数据的处理
- [ ] 页面状态切换的流畅性

## 后续优化建议

1. **缓存机制**:考虑对运行时配置进行本地缓存
2. **增量更新**:支持配置变更时的增量更新
3. **详情展示**:点击配置项查看详细信息
4. **操作功能**:添加配置的编辑、删除等操作
5. **实时更新**:考虑 WebSocket 等实时更新机制 