<view class="score-table-margin"></view>
<view class="score-container">
  <!-- 左侧固定列 -->
  <view class="fixed-column player-column">
    <view class="tb-header tb-header-player">{{isOneballMode ? '组别' : '球员'}}</view>
    <scroll-view
      scroll-y
      class="table-body"
      id="playerTable"
      scroll-top="{{ scrollTop }}"
      bindscroll="onPlayerScroll"
    >
      <block wx:if="{{isOneballMode}}">
        <view class="cell-player" wx:for="{{oneballRows}}" wx:key="key">
          <view wx:if="{{item.type === 'group'}}" class="oneball-player-cell">
            <view class="oneball-avatar-list">
              <PlayerAvatar
                wx:for="{{item.players}}"
                wx:key="user_id"
                avatar="{{item.avatar}}"
                show_name="{{item.show_name}}"
                userId="{{item.user_id}}"
                size="mini"
                shape="round"
                avatarOnly="{{true}}"
                clickable="{{false}}"
              />
            </view>
          </view>
          <view wx:elif="{{item.type === 'score'}}" class="oneball-score-label">
            <text>{{item.label}}</text>
          </view>
        </view>
      </block>
      <block wx:else>
        <view class="cell-player" wx:for="{{ players }}" wx:for-item="player" wx:key="user">
          <PlayerInfo index="{{ index }}" player="{{ player }}" />
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- 主滚动区域 -->
  <scroll-view scroll-x enhanced class="main-scroll" id="mainScroll">
    <!-- 中间内容区 -->
    <view
      class="scroll-content"
      style="width: {{ (holeList.length + (holeList.length === 18 ? 3 : 1)) * 80 }}px"
    >
      <!-- 表头 -->
      <view class="tb-header tb-header-holes">
        <!-- 前9洞表头 (1-9) -->
        <view
          wx:for="{{ holeList }}"
          wx:key="unique_key"
          wx:for-item="hole"
          wx:if="{{ holeList.length === 18 ? index < 9 : true }}"
          class="tb-header-hole"
        >
          <view class="hole-name">{{hole.holename}}</view>
          <view class="hole-par">{{hole.par}}</view>
        </view>
        <!-- OUT汇总表头 (仅18洞时，在前9洞后显示) -->
        <view wx:if="{{ holeList.length === 18 }}" class="tb-header-hole tb-header-out">
          <view class="total-text">OUT</view>
        </view>
        <!-- 后9洞表头 (10-18) -->
        <view
          wx:for="{{ holeList }}"
          wx:for-item="hole"
          wx:key="unique_key"
          wx:if="{{ holeList.length === 18 && index >= 9 }}"
          class="tb-header-hole"
        >
          <view class="hole-name">{{hole.holename}}</view>
          <view class="hole-par">{{hole.par}}</view>
        </view>

        <!-- IN汇总表头 (仅18洞时，在后9洞后显示) -->
        <view wx:if="{{ holeList.length === 18 }}" class="tb-header-hole tb-header-in">
          <view class="total-text">IN</view>
        </view>
        <!-- 总分表头 -->
        <view class="tb-header-hole tb-header-total">
          <view class="total-text">TOTAL</view>
        </view>
      </view>

      <!-- 内容行 -->
      <scroll-view
        scroll-y
        class="table-body"
        id="holesTable"
        scroll-top="{{ scrollTop }}"
        bindscroll="onHolesScroll"
        wx:if="{{ displayScores !== null && displayTotals !== null }}"
      >
        <block wx:if="{{isOneballMode}}">
          <view class="table-row {{item.type === 'score' ? 'oneball-score-row' : ''}}" wx:for="{{oneballRows}}" wx:key="key" wx:for-index="rowIndex">
            <block wx:if="{{item.type === 'group'}}">
              <!-- 前9洞 (1-9) -->
              <view
                wx:for="{{holeList}}"
                wx:key="unique_key"
                wx:for-index="holeIndex"
                wx:if="{{ holeList.length === 18 ? holeIndex < 9 : true }}"
                class="cell-score"
              >
                <HoleCell
                  playerIndex="{{ item.playerIndex }}"
                  holeIndex="{{ holeIndex }}"
                  holeList="{{ holeList }}"
                  players="{{ players }}"
                  displayScores="{{ displayScores }}"
                  bind:cellclick="onCellClick"
                />
              </view>
              <!-- OUT汇总单元格 (仅18洞时，在前9洞后显示) -->
              <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-out">
                <text
                  style="color:#333;font-size:16px;font-weight:bold;"
                >{{oneballRowOutTotals && oneballRowOutTotals[rowIndex] != null ? oneballRowOutTotals[rowIndex] : ''}}</text>
              </view>
              <!-- 后9洞 (10-18) -->
              <view
                wx:for="{{holeList}}"
                wx:key="unique_key"
                wx:for-index="holeIndex"
                wx:if="{{ holeList.length === 18 && holeIndex >= 9 }}"
                class="cell-score"
              >
                <HoleCell
                  playerIndex="{{ item.playerIndex }}"
                  holeIndex="{{ holeIndex }}"
                  holeList="{{ holeList }}"
                  players="{{ players }}"
                  displayScores="{{ displayScores }}"
                  bind:cellclick="onCellClick"
                />
              </view>
              <!-- IN汇总单元格 (仅18洞时，在后9洞后显示) -->
              <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-in">
                <text
                  style="color:#333;font-size:16px;font-weight:bold;"
                >{{oneballRowInTotals && oneballRowInTotals[rowIndex] != null ? oneballRowInTotals[rowIndex] : ''}}</text>
              </view>
              <!-- 总分单元格 -->
              <view class="cell-score cell-total">
                <text
                  style="color:#333;font-size:16px;font-weight:bold;"
                >{{oneballRowTotals && oneballRowTotals[rowIndex] != null ? oneballRowTotals[rowIndex] : ''}}</text>
              </view>
            </block>
            <block wx:elif="{{item.type === 'score'}}">
              <!-- 前9洞 (1-9) -->
              <view
                wx:for="{{holeList}}"
                wx:key="unique_key"
                wx:for-index="holeIndex"
                wx:if="{{ holeList.length === 18 ? holeIndex < 9 : true }}"
                class="cell-score oneball-score-cell"
              >
                <text
                  class="oneball-score-text {{oneballMatchResults[holeIndex] && oneballMatchResults[holeIndex].status === 'lose' ? 'is-loss' : ''}}"
                >{{oneballMatchResults[holeIndex] ? oneballMatchResults[holeIndex].text : ''}}</text>
              </view>
              <!-- OUT汇总单元格 (仅18洞时，在前9洞后显示) -->
              <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-out oneball-score-cell"></view>
              <!-- 后9洞 (10-18) -->
              <view
                wx:for="{{holeList}}"
                wx:key="unique_key"
                wx:for-index="holeIndex"
                wx:if="{{ holeList.length === 18 && holeIndex >= 9 }}"
                class="cell-score oneball-score-cell"
              >
                <text
                  class="oneball-score-text {{oneballMatchResults[holeIndex] && oneballMatchResults[holeIndex].status === 'lose' ? 'is-loss' : ''}}"
                >{{oneballMatchResults[holeIndex] ? oneballMatchResults[holeIndex].text : ''}}</text>
              </view>
              <!-- IN汇总单元格 (仅18洞时，在后9洞后显示) -->
              <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-in oneball-score-cell"></view>
              <!-- 总分单元格 -->
              <view class="cell-score cell-total oneball-score-cell"></view>
            </block>
          </view>
        </block>
        <block wx:else>
          <view class="table-row" wx:for="{{ players }}" wx:key="user" wx:for-index="playerIndex">
            <!-- 前9洞 (1-9) -->
            <view
              wx:for="{{holeList}}"
              wx:key="unique_key"
              wx:for-index="holeIndex"
              wx:if="{{ holeList.length === 18 ? holeIndex < 9 : true }}"
              class="cell-score"
            >
              <HoleCell
                playerIndex="{{ playerIndex }}"
                holeIndex="{{ holeIndex }}"
                holeList="{{ holeList }}"
                players="{{ players }}"
                displayScores="{{ displayScores }}"
                bind:cellclick="onCellClick"
              />
            </view>
            <!-- OUT汇总单元格 (仅18洞时，在前9洞后显示) -->
            <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-out">
              <text
                style="color:#333;font-size:16px;font-weight:bold;"
              >{{displayOutTotals && displayOutTotals[playerIndex] != null ? displayOutTotals[playerIndex] : ''}}</text>
            </view>
            <!-- 后9洞 (10-18) -->
            <view
              wx:for="{{holeList}}"
              wx:key="unique_key"
              wx:for-index="holeIndex"
              wx:if="{{ holeList.length === 18 && holeIndex >= 9 }}"
              class="cell-score"
            >
              <HoleCell
                playerIndex="{{ playerIndex }}"
                holeIndex="{{ holeIndex }}"
                holeList="{{ holeList }}"
                players="{{ players }}"
                displayScores="{{ displayScores }}"
                bind:cellclick="onCellClick"
              />
            </view>
            <!-- IN汇总单元格 (仅18洞时，在后9洞后显示) -->
            <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-in">
              <text
                style="color:#333;font-size:16px;font-weight:bold;"
              >{{displayInTotals && displayInTotals[playerIndex] != null ? displayInTotals[playerIndex] : ''}}</text>
            </view>
            <!-- 总分单元格 -->
            <view class="cell-score cell-total">
              <text
                style="color:#333;font-size:16px;font-weight:bold;"
              >{{displayTotals && displayTotals[playerIndex] !== undefined ? displayTotals[playerIndex] : ''}}</text>
            </view>
          </view>
        </block>
      </scroll-view>
      <!-- 数据加载中的占位符，避免表格突然出现 -->
      <scroll-view wx:else scroll-y class="table-body">
        <view class="table-row" wx:for="{{ players }}" wx:key="user" wx:for-index="playerIndex">
          <!-- 前9洞 (1-9) -->
          <view
            wx:for="{{holeList}}"
            wx:key="unique_key"
            wx:for-index="holeIndex"
            wx:if="{{ holeList.length === 18 ? holeIndex < 9 : true }}"
            class="cell-score loading-cell"
          ></view>
          <!-- OUT汇总单元格 (仅18洞时，在前9洞后显示) -->
          <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-out loading-cell"></view>
          <!-- 后9洞 (10-18) -->
          <view
            wx:for="{{holeList}}"
            wx:key="unique_key"
            wx:for-index="holeIndex"
            wx:if="{{ holeList.length === 18 && holeIndex >= 9 }}"
            class="cell-score loading-cell"
          ></view>
          <!-- IN汇总单元格 (仅18洞时，在后9洞后显示) -->
          <view wx:if="{{ holeList.length === 18 }}" class="cell-score cell-in loading-cell"></view>
          <!-- 总分单元格 -->
          <view class="cell-score cell-total loading-cell"></view>
        </view>
      </scroll-view>
    </view>
  </scroll-view>
</view>
