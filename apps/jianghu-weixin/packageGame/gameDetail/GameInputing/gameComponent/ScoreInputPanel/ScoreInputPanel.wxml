<!--components/ScoreInputPanel/ScoreInputPanel.wxml-->
<wxs src="/utils/image.wxs" module="image" />

<view class="modal-mask" wx:if="{{isVisible}}" bindtap="handleMaskClick">
  <view class="modal-content" catch:tap="preventBubble">
    <view class="panel-container" catch:tap="preventBubble">
      <view class="hole-info-bar">
        <view class="hole-name-container">
          <view class="hole-name-main">{{currentHole.holename}}</view>
        </view>
        <view class="hole-details-wrapper">
          <view class="hole-detail">PAR {{currentHole.par}}</view>
          <view class="hole-detail">码数 {{currentPlayerDistance || ''}}</view>
          <view class="hole-detail">
            发球台
            <view class="tee-indicator tee-{{currentPlayerTee}}"></view>
          </view>
        </view>
      </view>

      <view class="main-content">
        <view class="player-list-container">
          <scroll-view class="player-list-scroll" scroll-y>
            <view
              class="player-item {{index === activePlayerIndex ? 'active' : ''}}"
              wx:for="{{players}}"
              wx:key="index"
              bindtap="switchPlayer"
              data-index="{{index}}"
            >
              <image class="player-avatar" src="{{image.imageUrl(item.avatar)}}" />
              <view class="player-score">{{localScores[index] ? localScores[index].score : ''}}</view>
            </view>
          </scroll-view>
        </view>

        <view class="scoring-area-container">
          <view class="scoring-area">
            <view class="score-row">
              <text class="score-label">成绩</text>
              <view class="score-control">
                <view
                  class="control-btn minus"
                  data-type="score"
                  data-amount="-1"
                  bind:tap="changeScore"
                >-</view>
                <text class="score-value">{{localScores[activePlayerIndex].score}}</text>
                <view
                  class="control-btn plus"
                  data-type="score"
                  data-amount="1"
                  bind:tap="changeScore"
                >+</view>
              </view>
            </view>
            <view class="score-row">
              <text class="score-label">推杆</text>
              <view class="score-control">
                <view
                  class="control-btn minus"
                  data-type="putts"
                  data-amount="-1"
                  bind:tap="changeScore"
                >-</view>
                <text class="score-value">{{localScores[activePlayerIndex].putts}}</text>
                <view
                  class="control-btn plus"
                  data-type="putts"
                  data-amount="1"
                  bind:tap="changeScore"
                >+</view>
              </view>
            </view>
            <view class="score-row">
              <text class="score-label">罚杆</text>
              <view class="score-control">
                <view
                  class="control-btn minus"
                  data-type="penalty_strokes"
                  data-amount="-1"
                  bind:tap="changeScore"
                >-</view>
                <text class="score-value">{{localScores[activePlayerIndex].penalty_strokes || 0}}</text>
                <view
                  class="control-btn plus"
                  data-type="penalty_strokes"
                  data-amount="1"
                  bind:tap="changeScore"
                >+</view>
              </view>
            </view>
            <view class="score-row">
              <text class="score-label">沙坑</text>
              <view class="score-control">
                <view
                  class="control-btn minus"
                  data-type="sand_save"
                  data-amount="-1"
                  bind:tap="changeScore"
                >-</view>
                <text class="score-value">{{localScores[activePlayerIndex].sand_save || 0}}</text>
                <view
                  class="control-btn plus"
                  data-type="sand_save"
                  data-amount="1"
                  bind:tap="changeScore"
                >+</view>
              </view>
            </view>

            <view class="tee-shot-options">
              <view
                class="shot-option {{localScores[activePlayerIndex].tee_shot_direction === 'center' ? 'active' : ''}}"
                data-direction="center"
                bindtap="handleTeeShotDirection"
              >
                <view class="shot-icon-wrapper center">
                  <view class="target-ring"></view>
                  <view class="target-dot"></view>
                </view>
                <text class="shot-label">上球道</text>
              </view>
              <view
                class="shot-option {{localScores[activePlayerIndex].tee_shot_direction === 'left' ? 'active' : ''}}"
                data-direction="left"
                bindtap="handleTeeShotDirection"
              >
                <view class="shot-icon-wrapper arrow">
                  <image class="arrow-icon" src="/assets/icons/icons8-left-arrow-48.png" />
                </view>
                <text class="shot-label">拉左</text>
              </view>
              <view
                class="shot-option {{localScores[activePlayerIndex].tee_shot_direction === 'right' ? 'active' : ''}}"
                data-direction="right"
                bindtap="handleTeeShotDirection"
              >
                <view class="shot-icon-wrapper arrow">
                  <image class="arrow-icon" src="/assets/icons/icons8-right-arrow-48.png" />
                </view>
                <text class="shot-label">拉右</text>
              </view>
              <view
                class="shot-option {{localScores[activePlayerIndex].tee_shot_direction === 'long' ? 'active' : ''}}"
                data-direction="long"
                bindtap="handleTeeShotDirection"
              >
                <view class="shot-icon-wrapper arrow">
                  <image class="arrow-icon" src="/assets/icons/icons8-up-arrow-48.png" />
                </view>
                <text class="shot-label">打穿</text>
              </view>
              <view
                class="shot-option {{localScores[activePlayerIndex].tee_shot_direction === 'short' ? 'active' : ''}}"
                data-direction="short"
                bindtap="handleTeeShotDirection"
              >
                <view class="shot-icon-wrapper arrow">
                  <image class="arrow-icon" src="/assets/icons/icons8-down-arrow-48.png" />
                </view>
                <text class="shot-label">打短</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="modal-actions">
      <button class="modal-btn cancel" bind:tap="handleClear" disabled="{{isSaving}}">清除</button>
      <button
        class="modal-btn confirm"
        bind:tap="handleConfirm"
        disabled="{{isSaving}}"
      >{{isSaving ? '保存中...' : '确定'}}</button>
    </view>
  </view>
</view>
