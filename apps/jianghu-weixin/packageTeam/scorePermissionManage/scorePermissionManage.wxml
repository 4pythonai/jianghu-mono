<view class="container">
  <CustomNavBar title="记分管理" showBack="{{true}}" />

  <view class="page-content">
    <view class="section-title">谁可以记分</view>
    <view class="card">
      <checkbox-group bindchange="onPermissionChange">
        <label class="permission-item" wx:for="{{permissionOptions}}" wx:key="key">
          <checkbox value="{{item.key}}" checked="{{item.checked}}" color="#2e7d32" />
          <text class="permission-label">{{item.label}}</text>
        </label>
      </checkbox-group>
    </view>
    <view class="hint">至少选择一项</view>

    <!-- 球童二维码区域 -->
    <block wx:if="{{showCaddieQrcode}}">
      <view class="qrcode-section">
        <view class="qrcode-title">球童记分二维码</view>
        <view class="qrcode-card">
          <view class="qrcode-loading" wx:if="{{loadingQrcode}}">
            <view class="loading-spinner"></view>
            <text>加载中...</text>
          </view>
          <block wx:elif="{{caddieQrcode}}">
            <image
              class="qrcode-image"
              src="{{caddieQrcode}}"
              mode="aspectFit"
              show-menu-by-longpress="{{true}}"
            />
            <view class="qrcode-hint">球童扫码进入记分页面</view>
          </block>
          <view class="qrcode-error" wx:else>
            <text>二维码获取失败</text>
          </view>
        </view>
      </view>
    </block>

    <button
      class="btn btn-primary btn-block {{saving ? 'disabled' : ''}}"
      bindtap="onSave"
      loading="{{saving}}"
      disabled="{{saving}}"
    >保存</button>
  </view>
</view>
