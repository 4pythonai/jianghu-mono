<view class="board">
  <view class="board-header">
    <text class="col-rank">排名</text>
    <text class="col-player">球员</text>
    <text class="col-score">成绩</text>
    <text class="col-thru">已完成</text>
  </view>

  <view wx:if="{{rows.length === 0}}" class="board-empty">
    <text class="empty-text">暂无成绩</text>
  </view>

  <view
    wx:for="{{rows}}"
    wx:key="user_id"
    class="board-row-wrapper {{expandedUserId === item.user_id ? 'expanded' : ''}}"
  >
    <!-- 主行 -->
    <view
      class="board-row"
      data-user-id="{{item.user_id}}"
      data-player-index="{{item.playerIndex}}"
      bindtap="onRowTap"
    >
      <text class="col-rank">{{item.rankText}}</text>
      <view class="col-player player-cell">
        <image class="avatar" mode="aspectFill" src="{{item.avatarUrl}}" />
        <text class="name">{{item.show_name}}</text>
      </view>
      <text class="col-score">{{item.scoreText}}</text>
      <text class="col-thru">{{item.thruText}}</text>
      <view class="expand-icon {{expandedUserId === item.user_id ? 'rotated' : ''}}">
        <text class="iconfont icon-arrow-down"></text>
      </view>
    </view>

    <!-- 展开详情区域 -->
    <view wx:if="{{expandedUserId === item.user_id && holeList.length > 0}}" class="score-detail">
      <!-- 前9洞区块 -->
      <scroll-view scroll-x class="score-detail-scroll" enhanced>
        <view class="score-detail-content">
          <!-- 洞号行 (1-9 + OUT) -->
          <view class="detail-row hole-row">
            <block wx:for="{{holeList}}" wx:key="unique_key" wx:for-item="hole" wx:for-index="holeIdx">
              <view wx:if="{{holeIdx < 9}}" class="detail-cell hole-cell">
                <text>{{hole.holename}}</text>
              </view>
            </block>
            <view class="detail-cell summary-cell">
              <text>OUT</text>
            </view>
          </view>
          <!-- Par 行 (1-9) -->
          <view class="detail-row par-row">
            <block wx:for="{{holeList}}" wx:key="unique_key" wx:for-item="hole" wx:for-index="holeIdx">
              <view wx:if="{{holeIdx < 9}}" class="detail-cell par-cell">
                <text>{{hole.par}}</text>
              </view>
            </block>
            <view class="detail-cell summary-cell">
              <text>36</text>
            </view>
          </view>
          <!-- 成绩行 (1-9) -->
          <view class="detail-row score-row">
            <block wx:for="{{holeList}}" wx:key="unique_key" wx:for-item="hole" wx:for-index="holeIdx">
              <view wx:if="{{holeIdx < 9}}" class="detail-cell score-cell">
                <view class="score-badge {{displayScores[item.playerIndex][holeIdx].scoreClass}}">
                  <text>{{displayScores[item.playerIndex][holeIdx].score || ''}}</text>
                </view>
              </view>
            </block>
            <view class="detail-cell summary-cell score-summary">
              <text>{{displayScores[item.playerIndex].outTotal || ''}}</text>
            </view>
          </view>
        </view>
      </scroll-view>

      <!-- 后9洞区块 (仅18洞时显示) -->
      <scroll-view wx:if="{{holeList.length === 18}}" scroll-x class="score-detail-scroll second-half" enhanced>
        <view class="score-detail-content">
          <!-- 洞号行 (10-18 + IN + F) -->
          <view class="detail-row hole-row">
            <block wx:for="{{holeList}}" wx:key="unique_key" wx:for-item="hole" wx:for-index="holeIdx">
              <view wx:if="{{holeIdx >= 9}}" class="detail-cell hole-cell">
                <text>{{hole.holename}}</text>
              </view>
            </block>
            <view class="detail-cell summary-cell">
              <text>IN</text>
            </view>
            <view class="detail-cell summary-cell total-cell">
              <text>F</text>
            </view>
          </view>
          <!-- Par 行 (10-18) -->
          <view class="detail-row par-row">
            <block wx:for="{{holeList}}" wx:key="unique_key" wx:for-item="hole" wx:for-index="holeIdx">
              <view wx:if="{{holeIdx >= 9}}" class="detail-cell par-cell">
                <text>{{hole.par}}</text>
              </view>
            </block>
            <view class="detail-cell summary-cell">
              <text>36</text>
            </view>
            <view class="detail-cell summary-cell total-cell">
              <text>72</text>
            </view>
          </view>
          <!-- 成绩行 (10-18) -->
          <view class="detail-row score-row">
            <block wx:for="{{holeList}}" wx:key="unique_key" wx:for-item="hole" wx:for-index="holeIdx">
              <view wx:if="{{holeIdx >= 9}}" class="detail-cell score-cell">
                <view class="score-badge {{displayScores[item.playerIndex][holeIdx].scoreClass}}">
                  <text>{{displayScores[item.playerIndex][holeIdx].score || ''}}</text>
                </view>
              </view>
            </block>
            <view class="detail-cell summary-cell score-summary">
              <text>{{displayScores[item.playerIndex].inTotal || ''}}</text>
            </view>
            <view class="detail-cell summary-cell score-summary total-cell">
              <text>{{displayScores[item.playerIndex].total || ''}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
