<view class="g1-board">
  <!-- Team board with accordion -->
  <view class="team-board">
    <view class="team-header">
      <view class="col col-rank">排名</view>
      <view class="col col-team">球队</view>
      <view class="col col-valid">有效人数</view>
      <view class="col col-score">成绩</view>
    </view>

    <view wx:if="{{teamRows.length === 0}}" class="empty">
      <text class="empty-text">暂无分队成绩</text>
    </view>

    <view wx:for="{{teamRows}}" wx:key="tag_id" class="team-section">
      <!-- Team row (clickable) -->
      <view
        class="team-row {{item.isForfeit ? 'forfeit' : ''}} {{expandedTagId === item.tag_id ? 'expanded' : ''}}"
        bindtap="onTeamRowTap"
        data-tag-id="{{item.tag_id}}"
      >
        <view class="col col-rank">{{item.rankText}}</view>
        <view class="col col-team">
          <view class="team-name-wrap">
            <view class="expand-icon">{{expandedTagId === item.tag_id ? '▼' : '▶'}}</view>
            <view class="team-dot" style="background-color: {{item.tag_color || '#999'}}"></view>
            <text class="team-name">{{item.tag_name}}</text>
            <text wx:if="{{item.isForfeit}}" class="forfeit-text">弃赛</text>
          </view>
        </view>
        <view class="col col-valid">{{item.validNText}}</view>
        <view class="col col-score">{{item.scoreText}}</view>
      </view>

      <!-- Expanded player list -->
      <view wx:if="{{expandedTagId === item.tag_id}}" class="player-list">
        <!-- Player header -->
        <view class="player-header">
          <view class="p-col p-col-rank">排名</view>
          <view class="p-col p-col-player">球员</view>
          <view class="p-col p-col-score">成绩</view>
        </view>

        <view wx:if="{{expandedPlayers.length === 0}}" class="player-empty">
          <text>暂无球员</text>
        </view>
        <view
          wx:for="{{expandedPlayers}}"
          wx:for-item="player"
          wx:key="user_id"
          class="player-section"
        >
          <!-- Player row (clickable) -->
          <view
            class="player-row {{expandedPlayerId === player.user_id ? 'player-expanded' : ''}}"
            bindtap="onPlayerRowTap"
            data-user-id="{{player.user_id}}"
          >
            <view class="p-col p-col-rank">{{player.rank_label}}</view>
            <view class="p-col p-col-player">
              <image class="player-avatar" src="{{player.avatarUrl}}" mode="aspectFill" />
              <text class="player-name">{{player.show_name}}</text>
            </view>
            <view class="p-col p-col-score">
              <text>{{player.scoreText}}</text>
              <view class="player-expand-icon {{expandedPlayerId === player.user_id ? 'rotated' : ''}}">▼</view>
            </view>
          </view>

          <!-- Player score detail -->
          <ExpandPlayerScore
            wx:if="{{expandedPlayerId === player.user_id && holeList.length > 0 && player.playerIndex >= 0}}"
            holeList="{{holeList}}"
            playerScores="{{displayScores[player.playerIndex]}}"
          />
        </view>
      </view>
    </view>
  </view>
</view>

