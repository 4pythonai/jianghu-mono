<!-- 赛事封面 -->
<TeamEventBanner
  gameType="{{gameType}}"
  title="{{eventDetail.title}}"
  teamName="{{eventDetail.teamName}}"
  teamAvatar="{{eventDetail.teamAvatar}}"
  teams="{{eventDetail.teams}}"
  backgroundImage="{{eventDetail.backgroundImage}}"
  coverType="{{eventDetail.coverType}}"
  covers="{{eventDetail.covers}}"
/>

<!-- 基本信息 -->
<view class="event-detail-card-wrapper">
  <InfoCard title="基本信息">
    <view class="event-detail-info-list">
      <view class="event-detail-info-item">
        <image
          class="event-detail-info-icon"
          src="/assets/icons/icons-location.png"
          mode="aspectFit"
        />
        <text class="event-detail-info-text">{{eventDetail.location}}</text>
      </view>
      <view class="event-detail-info-item">
        <image class="event-detail-info-icon" src="/assets/icons/icons-clock.png" mode="aspectFit" />
        <text class="event-detail-info-text">{{eventDetail.dateTime}}</text>
      </view>
      <view class="event-detail-info-item">
        <image class="event-detail-info-icon" src="/assets/icons/icons-money.png" mode="aspectFit" />
        <text class="event-detail-info-text">{{eventDetail.fee}}</text>
      </view>
      <view class="event-detail-info-item">
        <image
          class="event-detail-info-icon"
          src="/assets/icons/icons-deadline.png"
          mode="aspectFit"
        />
        <text class="event-detail-info-text">{{eventDetail.deadline}}</text>
      </view>
    </view>
  </InfoCard>
</view>

<!-- 赛事流程 -->
<view class="event-detail-card-wrapper">
  <InfoCard title="赛事流程">
    <view class="event-detail-schedule-list">
      <view wx:for="{{eventDetail.schedule}}" wx:key="index" class="event-detail-schedule-item">
        <text class="event-detail-schedule-time">{{item.time}}</text>
        <text class="event-detail-schedule-content">{{item.content}}</text>
      </view>
    </view>
  </InfoCard>
</view>

<!-- 奖项设置 -->
<view class="event-detail-card-wrapper">
  <InfoCard title="奖项设置">
    <view class="event-detail-awards-list">
      <text wx:for="{{eventDetail.awards}}" wx:key="index" class="event-detail-award-item">{{item}}</text>
    </view>
  </InfoCard>
</view>

<!-- 悬浮更多按钮（仅创建者可见） -->
<view wx:if="{{isCreator}}" class="event-detail-floating-more-btn" bindtap="onMore">
  <text>更多</text>
</view>

<!-- 底部操作栏 -->
<BottomActionBar
  leftText="分享"
  rightText="{{isRegistered ? '取消报名' : '报名'}}"
  rightType="{{isRegistered ? 'warning' : 'primary'}}"
  bind:leftTap="onShare"
  bind:rightTap="onRegisterTap"
/>

<!-- 报名弹窗 -->
<view wx:if="{{showRegisterPopup}}" class="event-detail-popup-mask" bindtap="onCloseRegisterPopup">
  <view class="event-detail-popup-content event-detail-register-popup" catchtap>
    <view class="event-detail-popup-handle"></view>
    <view class="event-detail-register-title">报名信息</view>

    <!-- 分队选择 -->
    <view class="event-detail-tag-section">
      <view class="event-detail-tag-section-title">
        请选中您所代表的参赛球队
        <text class="event-detail-required">*</text>
      </view>
      <view class="event-detail-tag-list">
        <view
          wx:for="{{gameTags}}"
          wx:key="id"
          class="event-detail-tag-item {{selectedTagId === item.id ? 'event-detail-selected' : ''}}"
          data-tag-id="{{item.id}}"
          bindtap="onSelectTag"
        >
          <text class="event-detail-tag-name">{{item.tagName}}</text>
          <view wx:if="{{selectedTagId === item.id}}" class="event-detail-tag-check">✓</view>
        </view>
      </view>
      <view wx:if="{{gameTags.length === 0}}" class="event-detail-tag-empty">
        <text>暂无分队，请联系管理员设置</text>
      </view>
    </view>

    <!-- 用户基本信息 -->
    <view class="event-detail-register-form">
      <view class="event-detail-form-item">
        <text class="event-detail-form-label">昵称</text>
        <input
          class="event-detail-form-input"
          placeholder="请输入昵称"
          value="{{registerForm.show_name}}"
          bindinput="onDisplayNameInput"
        />
      </view>
      <view class="event-detail-form-item">
        <text class="event-detail-form-label">手机号</text>
        <input
          class="event-detail-form-input"
          placeholder="请输入手机号"
          type="number"
          maxlength="11"
          value="{{registerForm.mobile}}"
          bindinput="onMobileInput"
        />
      </view>
      <view class="event-detail-form-item">
        <text class="event-detail-form-label">性别</text>
        <view class="event-detail-gender-radio-group">
          <view
            class="event-detail-gender-radio {{registerForm.gender === 'male' ? 'event-detail-selected' : ''}}"
            data-gender="male"
            bindtap="onGenderSelect"
          >
            <view
              class="event-detail-radio-circle {{registerForm.gender === 'male' ? 'event-detail-checked' : ''}}"
            ></view>
            <text>男</text>
          </view>
          <view
            class="event-detail-gender-radio {{registerForm.gender === 'female' ? 'event-detail-selected' : ''}}"
            data-gender="female"
            bindtap="onGenderSelect"
          >
            <view
              class="event-detail-radio-circle {{registerForm.gender === 'female' ? 'event-detail-checked' : ''}}"
            ></view>
            <text>女</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="event-detail-register-buttons">
      <view class="event-detail-btn-cancel" bindtap="onCloseRegisterPopup">取消</view>
      <view
        class="event-detail-btn-submit {{!selectedTagId ? 'event-detail-disabled' : ''}}"
        bindtap="onSubmitRegister"
      >提交报名</view>
    </view>
  </view>
</view>

<!-- 更多操作弹窗 -->
<view wx:if="{{showMoreActions}}" class="event-detail-popup-mask" bindtap="onCloseMoreActions">
  <view class="event-detail-popup-content" catchtap>
    <view class="event-detail-popup-handle"></view>
    <view class="event-detail-actions-grid">
      <view class="event-detail-action-item" data-action="registerForFriend" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-icon-friend">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-apply-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">替好友报名</text>
      </view>
      <view class="event-detail-action-item" data-action="closeRegistration" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-icon-close-reg">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-checkbox-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">关闭报名</text>
      </view>
      <view class="event-detail-action-item" data-action="managePlayer" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-icon-manage">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-swap-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">选手管理</text>
      </view>
      <view class="event-detail-action-item" data-action="editGame" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-icon-edit">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-edit-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">修改比赛</text>
      </view>
      <view class="event-detail-action-item" data-action="editGroup" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-icon-group">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-group-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">修改分组</text>
      </view>
      <view class="event-detail-action-item" data-action="manageFee" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-icon-fee">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-coins-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">收费管理</text>
      </view>
      <view class="event-detail-action-item" data-action="cancelGame" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-icon-cancel">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-stopgame-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">取消比赛</text>
      </view>
      <view class="event-detail-action-item" data-action="startGame" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-action-icon-start">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-start-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">开始比赛</text>
      </view>
      <view class="event-detail-action-item" data-action="manageScore" bindtap="onActionTap">
        <view class="event-detail-action-icon event-detail-action-icon-score">
          <image
            class="event-detail-btn-icon-img"
            src="/assets/icons/icons8-edit-48.png"
            mode="aspectFit"
          />
        </view>
        <text class="event-detail-action-text">记分管理</text>
      </view>
    </view>
    <view class="event-detail-popup-cancel" bindtap="onCloseMoreActions">
      <text>取消</text>
    </view>
  </view>
</view>
