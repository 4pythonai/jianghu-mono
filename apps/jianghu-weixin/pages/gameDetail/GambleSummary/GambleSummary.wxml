<view class="gamble-summary">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-left">
      <text class="nav-title">æ¸¸æˆè¯¦æƒ…</text>
    </view>
    <view class="nav-right">
      <view class="nav-buttons">
        <view class="icon-btn" bindtap="showDrawer">
          <image class="nav-icon" src="/assets/icons/icons8-settings-50.png" mode="aspectFit"></image>
        </view>
        <view class="icon-btn" bindtap="gotoRuntimeConfigList">
          <image class="nav-icon" src="/assets/icons/icons8-right-arrow-50-3.png" mode="aspectFit"></image>
        </view>
      </view>
    </view>
  </view>

  <view class="gamble-container" style="display: flex; flex-direction: column; min-height: 100vh;">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æœ‰èµŒåšæ•°æ®æ—¶çš„å†…å®¹ -->
    <block wx:elif="{{gambleResults && gambleResults.length > 0}}">
      <!-- åªæœ‰ä¸€ä¸ªæ¸¸æˆæ—¶ï¼Œç›´æ¥æ˜¾ç¤ºæ˜ç»†ï¼Œä¸æ˜¾ç¤ºæ±‡æ€» -->
      <block wx:if="{{gambleResults.length === 1}}">
        <view class="gamble-results">
          <view
            class="gamble-result-item"
            wx:for="{{gambleResults}}"
            wx:key="index"
            wx:for-item="gambleResult"
          >
            <!-- èµŒåšç»“æœè¡¨æ ¼ -->
            <view
              class="gamble-result-title"
            >æ¸¸æˆé…ç½® {{gambleResult.gambleSysName}}/{{gambleResult.gambleUserName}}</view>
            <GambleResultTable
              groupInfo="{{gambleResult.group_info}}"
              usefulHoles="{{gambleResult.useful_holes}}"
              qrcode_url="{{gambleResult.qrcode_url}}"
              showQr="{{false}}"
            ></GambleResultTable>
          </view>
        </view>
      </block>

      <!-- å¤šä¸ªæ¸¸æˆæ—¶ï¼Œæ˜¾ç¤ºæ±‡æ€»å’Œèœå• -->
      <block wx:else>
        <!-- èµŒåšæ±‡æ€»è¡¨æ ¼ -->
        <view
          class="gamble-total-table"
          wx:if="{{currentDisplayType === 'summary'}}"
          style="flex: 1;"
        >
          <view class="gamble-result-title">æ¸¸æˆæ±‡æ€»/å‡ºå³è¾¹æ¨ªèœå•</view>
          <GambleTotalTable
            groupInfo="{{SummaryResult.group_info}}"
            usefulHoles="{{SummaryResult.useful_holes}}"
            qrcode_url="{{''}}"
            showQr="{{false}}"
          ></GambleTotalTable>
        </view>

        <!-- èµŒåšç»“æœåˆ—è¡¨ -->
        <view class="gamble-results">
          <view
            class="gamble-result-item"
            wx:for="{{gambleResults}}"
            wx:key="index"
            wx:for-item="gambleResult"
            wx:if="{{currentDisplayType === 'detail' && currentDetailIndex === index}}"
          >
            <!-- èµŒåšç»“æœæ ‡é¢˜ - åªæœ‰å½“æœ‰å¤šä¸ªèµŒåšé…ç½®æ—¶æ‰æ˜¾ç¤º -->
            <view
              class="gamble-result-title"
              wx:if="{{gambleResults.length > 1}}"
            >æ¸¸æˆé…ç½® {{gambleResult.gambleSysName}}/{{gambleResult.gambleUserName}}</view>

            <!-- èµŒåšç»“æœè¡¨æ ¼ -->
            <GambleResultTable
              groupInfo="{{gambleResult.group_info}}"
              usefulHoles="{{gambleResult.useful_holes}}"
              qrcode_url="{{gambleResult.qrcode_url}}"
              showQr="{{false}}"
            ></GambleResultTable>
          </view>
        </view>

        <!-- é»˜è®¤æ˜¾ç¤ºæç¤ºä¿¡æ¯ -->
        <view class="gamble-hint" wx:if="{{!currentDisplayType}}">
          <text class="hint-text">ç‚¹å‡»å³ä¸Šè§’è®¾ç½®æŒ‰é’®æŸ¥çœ‹è¯¦ç»†æ•°æ®</text>
        </view>
      </block>
    </block>

    <!-- æš‚æ— èµŒåšæ•°æ®çŠ¶æ€ -->
    <view
      class="empty-state"
      wx:elif="{{!loading && (!gambleResults || gambleResults.length === 0)}}"
    >
      <view class="no-gamble-container">
        <!-- <view class="summary-title">æ±‡æ€»å¾…å¼€å‘[gameID:{{gameid}}][groupID:{{groupid}}]</view> -->
        <image class="ps-image" src="/images/ps.jpg" mode="aspectFit"></image>
        <text class="empty-hint">æš‚æ— æ¸¸æˆ</text>
        <!-- æŒ‰é’®åŒºåŸŸ -->
        <view class="bottom-button-area">
          <button class="add-game-button" bindtap="handleAddGame">
            <text class="button-emoji">ğŸ®</text>
            <text class="button-text">æ·»åŠ æ¸¸æˆ</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- çª„èœå•æ¡ - åªæœ‰å¤šä¸ªæ¸¸æˆæ—¶æ‰æ˜¾ç¤º -->
  <view class="floating-menu" wx:if="{{gambleResults && gambleResults.length > 1}}">
    <view class="menu-item" bindtap="onMenuAction" data-action="viewDetail">
      <text class="menu-text">æ˜ç»†</text>
    </view>
  </view>

  <!-- Drawer ç»„ä»¶ -->
  <Drawer
    id="drawer"
    gameid="{{gameid}}"
    groupid="{{groupid}}"
    createTime="{{createTime}}"
    gameStatus="{{gameStatus}}"
    summaryResult="{{SummaryResult}}"
    gambleResults="{{gambleResults}}"
    bind:open="onDrawerOpen"
    bind:close="onDrawerClose"
    bind:confirm="onDrawerConfirm"
    bind:switchDisplay="switchDisplay"
  ></Drawer>
</view>
