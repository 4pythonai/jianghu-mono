<wxs src="/utils/image.wxs" module="image" />
<view class="container">
  <CustomNavBar title="编辑资料" showBack="{{true}}" />

  <!-- 头像和昵称卡片 -->
  <view class="profile-header">
    <view class="avatar-section">
      <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <image
          class="avatar-img"
          src="{{image.imageUrl(userInfo.avatar) || '/images/default-avatar.png'}}"
          mode="aspectFill"
        />
      </button>
    </view>

    <view class="showname-section">
      <input
        class="showname-input"
        type="text"
        value="{{form.show_name}}"
        placeholder="请输入昵称"
        maxlength="20"
        bindinput="onDisplayNameInput"
      />
      <text class="showname-hint">{{form.show_name.length}}/20</text>
    </view>
  </view>

  <!-- 二维码卡片 -->
  <view class="qrcode-card" bindtap="onTapQrcode">
    <view class="qrcode-header">
      <text class="qrcode-title">我的二维码</text>
      <text class="qrcode-subtitle">扫码查看我的主页</text>
    </view>
    <view class="qrcode-display">
      <image class="qrcode-img" src="{{qrcodeUrl }}" mode="aspectFit" />
    </view>
    <text class="qrcode-hint">{{qrcodeUrl ? '点击预览/保存二维码' : '正在生成...'}}</text>
  </view>

  <!-- 个人信息表单 -->
  <view class="form-card">
    <view class="form-title">基本信息</view>

    <view class="form-row">
      <text class="form-label">手机号</text>
      <text class="form-value readonly">{{userInfo.mobile || '未绑定'}}</text>
    </view>

    <view class="form-row column">
      <text class="form-label">性别</text>
      <view class="radio-group">
        <view class="radio-item" data-value="male" bindtap="onGenderSelect">
          <view class="radio-content">
            <text class="gender-icon male">♂</text>
            <text class="radio-text">男</text>
          </view>
          <view class="radio-circle {{form.gender === 'male' ? 'checked' : ''}}">
            <view class="radio-dot" wx:if="{{form.gender === 'male'}}"></view>
          </view>
        </view>

        <view class="radio-item" data-value="female" bindtap="onGenderSelect">
          <view class="radio-content">
            <text class="gender-icon female">♀</text>
            <text class="radio-text">女</text>
          </view>
          <view class="radio-circle {{form.gender === 'female' ? 'checked' : ''}}">
            <view class="radio-dot" wx:if="{{form.gender === 'female'}}"></view>
          </view>
        </view>

        <view class="radio-item" data-value="unknown" bindtap="onGenderSelect">
          <view class="radio-content">
            <text class="radio-text">保密</text>
          </view>
          <view class="radio-circle {{form.gender === 'unknown' ? 'checked' : ''}}">
            <view class="radio-dot" wx:if="{{form.gender === 'unknown'}}"></view>
          </view>
        </view>
      </view>
    </view>

    <view class="form-row column">
      <text class="form-label">个性签名</text>
      <textarea
        class="signature-textarea"
        placeholder="写点关于你的故事..."
        maxlength="60"
        value="{{form.signature}}"
        bindinput="onSignatureInput"
      ></textarea>
      <text class="char-counter">{{form.signature.length}}/60</text>
    </view>
  </view>

  <!-- 保存按钮 -->
  <view class="save-section">
    <button class="save-btn" bindtap="saveProfile" loading="{{saving}}" disabled="{{saving}}">保存修改</button>
  </view>
</view>
