<wxs src="/utils/image.wxs" module="image" />
<view class="container">
  <CustomNavBar title="我的资料" showBack="{{true}}" />

  <view class="header-card">
    <view class="avatar-wrap">
      <button class="avatar-button" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <image
          class="avatar"
          src="{{image.imageUrl(userInfo.avatar) || '/images/default-avatar.png'}}"
          mode="aspectFill"
        />
        <view class="avatar-subtitle">更换头像</view>
      </button>
    </view>

    <view class="basic-info">
      <view class="nickname-row">
        <input
          class="nickname-input"
          type="text"
          value="{{form.nickname}}"
          placeholder="填写昵称"
          maxlength="20"
          bindinput="onNicknameInput"
        />
        <view class="gender-pill {{form.gender}}">
          <text wx:if="{{form.gender === 'male'}}">♂</text>
          <text wx:elif="{{form.gender === 'female'}}">♀</text>
          <text wx:else>未设</text>
        </view>
      </view>
      <view class="meta-row">
        <view class="meta-chip">
          <text class="meta-label">手机号</text>
          <text class="meta-value">{{userInfo.mobile || '未绑定'}}</text>
        </view>
        <view class="meta-chip" wx:if="{{userInfo.handicap}}">
          <text class="meta-label">差点</text>
          <text class="meta-value">{{userInfo.handicap}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="qrcode-card" bindtap="onTapQrcode">
    <view class="qrcode-title">我的二维码</view>
    <image
      class="qrcode-large"
      src="{{qrcodeUrl || '/assets/icons/icons8-qrcode-48.png'}}"
      mode="aspectFit"
    />
    <text class="qrcode-hint">{{qrcodeUrl ? '点击查看/保存二维码' : '等待后台生成二维码'}}</text>
  </view>

  <view class="info-card">
    <view class="card-title">个人信息</view>

    <view class="form-item">
      <text class="form-label">手机号</text>
      <text class="form-value muted">{{userInfo.mobile || '暂未绑定'}}</text>
    </view>

    <view class="form-item column">
      <view class="form-label">个性签名</view>
      <textarea
        class="form-textarea"
        placeholder="写点球场故事..."
        maxlength="60"
        value="{{form.signature}}"
        bindinput="onSignatureInput"
      ></textarea>
      <view class="word-counter">{{form.signature.length}}/60</view>
    </view>

    <view class="form-item column">
      <view class="form-label">性别</view>
      <view class="gender-options">
        <view
          class="gender-chip {{form.gender === 'male' ? 'active' : ''}}"
          data-value="male"
          bindtap="onGenderSelect"
        >男</view>
        <view
          class="gender-chip {{form.gender === 'female' ? 'active' : ''}}"
          data-value="female"
          bindtap="onGenderSelect"
        >女</view>
        <view
          class="gender-chip {{form.gender === 'unknown' ? 'active' : ''}}"
          data-value="unknown"
          bindtap="onGenderSelect"
        >保留</view>
      </view>
    </view>
  </view>

  <view class="actions">
    <button class="save-btn" bindtap="saveProfile" loading="{{saving}}" disabled="{{saving}}">保存资料</button>
  </view>
</view>
