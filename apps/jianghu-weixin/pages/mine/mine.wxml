<wxs src="/utils/image.wxs" module="image" />
<view class="container">
  <!-- 顶部用户信息区域 -->
  <view class="user-header">
    <!-- 通知图标 -->
    <view class="notification-icon" style="top: {{ notificationTop }}px;">
      <image src="/assets/icons/icons8-notification-48.png" mode="aspectFit"></image>
      <view class="notification-dot" wx:if="{{ hasNotification }}"></view>
    </view>

    <!-- 用户信息卡片 -->
    <view class="user-card" bindtap="goToProfile">
      <view class="avatar-container">
        <image
          class="avatar"
          src="{{ image.imageUrl(userInfo.avatar) || '/images/default-avatar.png' }}"
          mode="aspectFill"
        ></image>
      </view>
      <view class="user-details">
        <view class="nickname-row">
          <text class="nickname">{{ userInfo.nickname || '微信用户' }}</text>
          <text class="gender-icon" wx:if="{{ userInfo.gender === 'male' }}">♂</text>
          <text class="gender-icon female" wx:if="{{ userInfo.gender === 'female' }}">♀</text>
        </view>
        <view class="stats-row">
          <text class="stat-item">江湖差点 {{ userInfo.handicap || '--' }}</text>
          <text class="stat-item">浮动系数 {{ userInfo.floatCoef || '--' }}</text>
        </view>
      </view>
      <view class="qrcode-container">
        <image
          class="qrcode"
          src="{{ userInfo.qrcode || '/assets/icons/icons8-qrcode-48.png' }}"
          mode="aspectFit"
        ></image>
      </view>
      <view class="arrow-icon">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 认证区域（未完善信息时显示） -->
  <view class="auth-section" wx:if="{{ showAuthButton }}">
    <view class="auth-title">完善个人信息</view>
    <view class="auth-form">
      <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <image
          class="preview-avatar"
          src="{{ image.imageUrl(userInfo.avatar) || '/images/default-avatar.png' }}"
        ></image>
        <text class="avatar-text">点击选择头像</text>
      </button>
      <view class="nickname-input-wrapper">
        <text class="input-label">昵称:</text>
        <view class="nickname-input-container">
          <input
            class="nickname-input"
            type="nickname"
            value="{{ tempNickname || userInfo.nickname || '' }}"
            placeholder="请输入昵称"
            maxlength="20"
            bindinput="onNicknameInput"
            bindchange="onNicknameChange"
          />
        </view>
      </view>
      <button class="confirm-btn" bindtap="confirmUserInfo">保存昵称</button>
    </view>
  </view>

  <!-- 绑定手机号按钮 -->
  <button
    class="phone-btn"
    wx:if="{{ needBindPhone && userInfo }}"
    open-type="getPhoneNumber"
    bindgetphonenumber="getPhoneNumber"
  >绑定手机号码</button>

  <!-- 功能菜单组1 -->
  <view class="menu-group">
    <view class="menu-item" bindtap="goToContacts">
      <view class="menu-icon">
        <image src="/assets/icons/icons8-contact-48.png" mode="aspectFit"></image>
      </view>
      <text class="menu-text">通信录</text>
      <view class="menu-arrow">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
    <view class="menu-item" bindtap="goToHistory">
      <view class="menu-icon">
        <image src="/assets/icons/icons8-history-48.png" mode="aspectFit"></image>
      </view>
      <text class="menu-text">历史成绩</text>
      <view class="menu-arrow">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
    <view class="menu-item" bindtap="goToFootprint">
      <view class="menu-icon">
        <image src="/assets/icons/icons8-route-48.png" mode="aspectFit"></image>
      </view>
      <text class="menu-text">江湖足迹</text>
      <view class="menu-arrow">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
    <view class="menu-item" bindtap="goToMyTeam">
      <view class="menu-icon">
        <image src="/assets/icons/icons8-team-48.png" mode="aspectFit"></image>
      </view>
      <text class="menu-text">我的球队</text>
      <view class="menu-arrow">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 功能菜单组2 -->
  <view class="menu-group">
    <view class="menu-item" bindtap="goToWallet">
      <view class="menu-icon">
        <image src="/assets/icons/icons8-wallet-48.png" mode="aspectFit"></image>
      </view>
      <text class="menu-text">我的钱包</text>
      <view class="menu-arrow">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
    <view class="menu-item" bindtap="goToLedger">
      <view class="menu-icon">
        <image src="/assets/icons/icons8-notebook-48.png" mode="aspectFit"></image>
      </view>
      <text class="menu-text">小账本</text>
      <view class="menu-arrow">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 功能菜单组3 -->
  <view class="menu-group">
    <view class="menu-item" bindtap="goToSettings">
      <view class="menu-icon">
        <image src="/assets/icons/icons8-settings-50.png" mode="aspectFit"></image>
      </view>
      <text class="menu-text">设置</text>
      <view class="menu-arrow">
        <image src="/assets/icons/icons8-right-arrow-100.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>
</view>
