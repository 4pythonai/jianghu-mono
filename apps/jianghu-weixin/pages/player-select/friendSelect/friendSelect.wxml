<view class="page-container">
  <view class="content">
    <!-- é¡¶éƒ¨è£…é¥°åœ†å½¢ -->
    <view class="top-circle">
      <image class="top-circle-icon" src="/assets/icons/icons8-friends-48.png" mode="aspectFit"></image>
    </view>
    <!-- å·²æ·»åŠ çƒå‘˜åˆ—è¡¨ -->
    <attened-players
      wx:if="{{attenedPlayers.length > 0}}"
      players="{{attenedPlayers}}"
      bind:delete="onPlayerDelete"
    />
    <!-- æœç´¢æ¡† -->
    <view class="search-section">
      <view class="search-box">
        <text class="search-icon">ğŸ”</text>
        <input
          class="search-input"
          type="text"
          placeholder="æœç´¢å¥½å‹æ˜µç§°æˆ–ID"
          placeholder-class="search-placeholder"
          bindinput="onSearchInput"
        />
        <view class="clear-btn" bindtap="clearSearch">
          <text>æ¸…ç©º</text>
        </view>
      </view>
    </view>
    <!-- é€‰æ‹©ç»Ÿè®¡ -->
    <view class="selection-stats" wx:if="{{ selectedFriends.length > 0 }}">
      <text class="stats-text">å·²é€‰æ‹© {{selectedFriends.length}}/{{maxSelect}} äºº</text>
      <button class="confirm-btn" bindtap="confirmSelection">ç¡®è®¤é€‰æ‹© ({{selectedFriends.length}})</button>
    </view>
    <!-- å¥½å‹åˆ—è¡¨ -->
    <view wx:if="{{ friends.length > 0 }}" class="friends-list">
      <view
        wx:for="{{ friends }}"
        wx:key="userid"
        class="friend-item {{ item.selected ? 'selected' : '' }}"
        data-index="{{ index }}"
        bindtap="toggleFriendSelection"
      >
        <view class="friend-content">
          <image
            class="friend-avatar"
            src="{{ item.avatar || item.avatar || '/images/default-avatar.png' }}"
            mode="aspectFill"
            lazy-load="true"
          ></image>
          <view class="friend-info">
            <text class="friend-name">{{item.nickname || item.wx_nickname || 'æœªçŸ¥å¥½å‹'}}</text>
            <text class="friend-id">ID: {{item.userid}}</text>
            <text
              wx:if="{{ item.handicap !== undefined }}"
              class="friend-handicap"
            >æ†æ•°: {{item.handicap}}</text>
          </view>
          <!-- é€‰æ‹©çŠ¶æ€æŒ‡ç¤ºå™¨ -->
          <view class="selection-indicator">
            <view wx:if="{{ item.selected }}" class="selected-check">
              <text class="check-text">âœ“</text>
            </view>
            <view wx:else class="unselected-circle"></view>
          </view>
        </view>
      </view>
    </view>
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <text class="empty-text">æš‚æ— å¥½å‹</text>
      <text class="empty-desc">æ‚¨è¿˜æ²¡æœ‰æ·»åŠ è¿‡å¥½å‹</text>
    </view>
    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="bottom-action">
      <button class="action-btn action-cancel" bindtap="onCancel">å–æ¶ˆ</button>
      <button
        class="action-btn action-confirm"
        bindtap="confirmSelection"
        disabled="{{ selectedFriends.length === 0 }}"
      >ç¡®è®¤é€‰æ‹©{{ selectedFriends.length > 0 ? ' (' + selectedFriends.length + ')' : '' }}</button>
    </view>
  </view>
</view>
