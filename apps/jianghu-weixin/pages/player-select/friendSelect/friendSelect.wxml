<view class="page-container">
  <view class="content">
    <!-- é¡¶éƒ¨è£…é¥°åœ†å½¢ -->
    <view class="top-circle">
      <image class="top-circle-icon" src="/assets/icons/icons8-friends-48.png" mode="aspectFit"></image>
    </view>
    <!-- å·²æ·»åŠ çƒå‘˜åˆ—è¡¨ -->
    <attened-players />
    <!-- æœç´¢æ¡† -->
    <view class="search-section">
      <view class="search-box">
        <text class="search-icon">ğŸ”</text>
        <input
          class="search-input"
          type="text"
          placeholder="æœç´¢å¥½å‹æ˜µç§°æˆ–ID"
          placeholder-class="search-placeholder"
          bindinput="onSearchInput"
        />
        <view class="clear-btn" bindtap="clearSearch">
          <text>æ¸…ç©º</text>
        </view>
      </view>
    </view>
    <!-- é€‰æ‹©ç»Ÿè®¡ -->
    <view class="selection-stats" wx:if="{{ selectedFriends.length > 0 }}">
      <text class="stats-text">å·²é€‰æ‹© {{selectedFriends.length}}/{{maxSelect}} äºº</text>
      <button class="confirm-btn" bindtap="confirmSelection">ç¡®è®¤é€‰æ‹© ({{selectedFriends.length}})</button>
    </view>
    <!-- å¥½å‹åˆ—è¡¨ï¼ˆæŒ‰å­—æ¯åˆ†ç»„ï¼‰ -->
    <view wx:if="{{ groupedFriends.length > 0 }}" class="friends-list">
      <!-- å­—æ¯åˆ†ç»„ -->
      <view
        wx:for="{{ groupedFriends }}"
        wx:for-item="group"
        wx:for-index="groupIndex"
        wx:key="letter"
        class="letter-group"
        id="group-{{ group.letter }}"
      >
        <!-- å­—æ¯æ ‡é¢˜ -->
        <view class="letter-header">
          <text class="letter-text">{{ group.letter }}</text>
        </view>
        <!-- è¯¥å­—æ¯ä¸‹çš„å¥½å‹ -->
        <view
          wx:for="{{ group.friends }}"
          wx:for-item="item"
          wx:for-index="friendIndex"
          wx:key="userid"
          class="friend-item {{ item.selected ? 'selected' : '' }}"
          data-group-index="{{ groupIndex }}"
          data-friend-index="{{ friendIndex }}"
          bindtap="toggleGroupedFriendSelection"
        >
          <view class="friend-content">
            <!-- é€‰æ‹©çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆå·¦ä¾§ï¼‰ -->
            <view class="selection-indicator">
              <view wx:if="{{ item.selected }}" class="selected-check">
                <text class="check-text">âœ“</text>
              </view>
              <view wx:else class="unselected-circle"></view>
            </view>
            <image
              class="friend-avatar"
              src="{{ item.avatar || '/images/default-avatar.png' }}"
              mode="aspectFill"
              lazy-load="true"
            ></image>
            <view class="friend-info">
              <text class="friend-name">{{item.nickname || item.wx_nickname || 'æœªçŸ¥å¥½å‹'}}</text>
              <text class="friend-id">ID: {{item.userid}}</text>
              <text
                wx:if="{{ item.handicap !== undefined }}"
                class="friend-handicap"
              >æ†æ•°: {{item.handicap}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <text class="empty-text">æš‚æ— å¥½å‹</text>
      <text class="empty-desc">æ‚¨è¿˜æ²¡æœ‰æ·»åŠ è¿‡å¥½å‹</text>
    </view>
    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="bottom-action">
      <button class="action-btn action-cancel" bindtap="onCancel">å–æ¶ˆ</button>
      <button
        class="action-btn action-confirm"
        bindtap="confirmSelection"
        disabled="{{ selectedFriends.length === 0 }}"
      >ç¡®è®¤é€‰æ‹©{{ selectedFriends.length > 0 ? ' (' + selectedFriends.length + ')' : '' }}</button>
    </view>
  </view>

  <!-- å­—æ¯ç´¢å¼•æ  -->
  <view
    wx:if="{{ indexList.length > 0 }}"
    class="index-bar"
    catchtouchmove="onIndexTouchMove"
  >
    <view
      wx:for="{{ indexList }}"
      wx:key="*this"
      class="index-item {{ currentLetter === item ? 'active' : '' }}"
      data-letter="{{ item }}"
      bindtap="onIndexTap"
    >
      <text>{{ item }}</text>
    </view>
  </view>

  <!-- å­—æ¯æç¤ºæ°”æ³¡ -->
  <view wx:if="{{ showLetterToast }}" class="letter-toast">
    <text>{{ currentLetter }}</text>
  </view>
</view>
