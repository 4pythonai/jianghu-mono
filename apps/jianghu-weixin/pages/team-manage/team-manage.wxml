<wxs src="/utils/image.wxs" module="img" />
<view class="container">
  <CustomNavBar title="球队管理" showBack="{{true}}" />

  <!-- 内容区域，需要留出导航栏高度 -->
  <view class="page-content" style="padding-top: {{navBarHeight}}px;">
    <!-- 加载中 -->
    <view class="loading-container" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 主内容 -->
    <view class="main-content" wx:else>
      <!-- 球队信息头部 -->
      <view class="team-header">
        <image class="team-logo" src="{{img.imageUrl(teamInfo.team_avatar)}}" mode="aspectFill"></image>
        <view class="team-basic">
          <view class="team-name">{{teamInfo.team_name}}</view>
          <view class="team-slogan">{{teamInfo.sologan || '暂无口号'}}</view>
          <view class="my-role">
            <text wx:if="{{myRole === 'SuperAdmin'}}" class="role-tag team-superadmin">超级管理员</text>
            <text wx:elif="{{myRole === 'admin'}}" class="role-tag admin">管理员</text>
            <text wx:else class="role-tag member">成员</text>
          </view>
        </view>
      </view>

      <!-- 管理操作列表 -->
      <view class="manage-section">
        <view class="section-title">球队管理</view>

        <!-- 审批入队 - 需要 approve_join 权限 -->
        <view class="manage-item" wx:if="{{permissions.approve_join}}" bindtap="goApproveJoin">
          <text class="item-text">审批入队</text>
          <view class="item-badge" wx:if="{{pendingCount > 0}}">{{pendingCount}}</view>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>

        <!-- 拉入队员 - 需要 invite_member 权限 -->
        <view class="manage-item" wx:if="{{permissions.invite_member}}" bindtap="goInviteMember">
          <text class="item-text">邀请队员</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>

        <!-- 队员管理（含踢出） - 需要 remove_member 权限 -->
        <view class="manage-item" wx:if="{{permissions.remove_member}}" bindtap="goMemberManage">
          <text class="item-text">队员管理</text>
          <text class="item-desc">{{teamInfo.member_count || 0}}人</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>

        <!-- 创建队内赛 - 需要 create_game 权限 -->
        <view class="manage-item" wx:if="{{permissions.create_game}}" bindtap="goCreateGame">
          <text class="item-text">创建队内赛</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>

        <!-- 财务统计 - 需要 finance_stats 权限 -->
        <view class="manage-item" wx:if="{{permissions.finance_stats}}" bindtap="goFinanceStats">
          <text class="item-text">财务统计</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 超级管理员专属操作 -->
      <view class="manage-section" wx:if="{{myRole === 'SuperAdmin'}}">
        <view class="section-title">超级管理员</view>

        <!-- 管理员设置 -->
        <view class="manage-item" bindtap="goAdminManage">
          <text class="item-text">管理员设置</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>

        <!-- 转让超管 -->
        <view class="manage-item" bindtap="goTransferOwner">
          <text class="item-text">转让超级管理员</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>

        <!-- 编辑球队信息 -->
        <view class="manage-item" bindtap="goEditTeam">
          <text class="item-text">编辑球队信息</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 普通成员操作 -->
      <view class="manage-section">
        <view class="section-title">其他</view>

        <!-- 查看队员列表 -->
        <view class="manage-item" bindtap="goMemberList">
          <text class="item-text">队员列表</text>
          <text class="item-desc">{{teamInfo.member_count || 0}}人</text>
          <image class="item-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
        </view>

        <!-- 退出球队 -->
        <view class="manage-item danger" bindtap="onQuitTeam" wx:if="{{myRole !== 'SuperAdmin'}}">
          <text class="item-text">退出球队</text>
        </view>
      </view>
    </view>
  </view>
</view>
