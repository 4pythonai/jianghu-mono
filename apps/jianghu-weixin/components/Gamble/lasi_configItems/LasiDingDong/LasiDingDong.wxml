<!-- 顶洞规则配置组件 -->
<wxs src="/utils/es.wxs" module="util" />
<!-- 显示部分 -->
<view class="rule-section" wx:if="{{!visible}}">
  <view class="form-label">顶洞规则</view>
  <view class="form-select" bindtap="onShowConfig">
    <input
      class="form-input {{disabled ? 'conditionally-disabled' : ''}}"
      value="{{displayValue}}"
      disabled="{{disabled}}"
    />
    <view class="select-arrow">
      <text class="arrow-circle">▼</text>
    </view>
  </view>
</view>

<!-- 弹窗部分 -->
<view class="modal-mask" wx:if="{{visible}}" bindtap="onCancel">
  <view class="modal-content" catchtap="noTap">
    <view class="modal-title">顶洞规则</view>
    <view class="modal-list">
      <!-- 得分打平选项 -->
      <view class="modal-item" catchtap="onSelect" data-index="0">
        <view class="radio-outer {{drawConfig === 'DrawEqual' ? 'checked' : ''}}">
          <view class="radio-inner" wx:if="{{drawConfig === 'DrawEqual'}}"></view>
        </view>
        <view class="option-content">
          <text>得分打平</text>
        </view>
      </view>

      <!-- 得分X分以内选项 -->
      <view class="modal-item" catchtap="onSelect" data-index="1">
        <view class="radio-outer {{drawConfig && util.includes(drawConfig, 'Diff_') ? 'checked' : ''}}">
          <view class="radio-inner" wx:if="{{drawConfig && util.includes(drawConfig, 'Diff_')}}"></view>
        </view>
        <view class="option-content">
          <text>得分</text>

          <!-- 分数选择器 -->
          <picker
            wx:if="{{drawConfig && util.includes(drawConfig, 'Diff_')}}"
            class="score-picker"
            range="{{diffScores}}"
            value="{{diffScores.indexOf(util.parseIntFromString(drawConfig, 'Diff_') || defaultDiffScore)}}"
            bindchange="onDiffScoreChange"
          >
            <view class="picker-value">{{util.parseIntFromString(drawConfig, 'Diff_') || defaultDiffScore}}</view>
          </picker>
          <text wx:if="{{drawConfig && util.includes(drawConfig, 'Diff_')}}">分以内</text>

          <!-- 显示当前选中但未激活的选项文本 -->
          <text wx:if="{{!(drawConfig && util.includes(drawConfig, 'Diff_'))}}">{{util.parseIntFromString(drawConfig, 'Diff_') || defaultDiffScore}}分以内</text>
        </view>
      </view>

      <!-- 无顶洞选项 -->
      <view class="modal-item" catchtap="onSelect" data-index="2">
        <view class="radio-outer {{drawConfig === 'NoDraw' ? 'checked' : ''}}">
          <view class="radio-inner" wx:if="{{drawConfig === 'NoDraw'}}"></view>
        </view>
        <view class="option-content">
          <text>无顶洞</text>
        </view>
      </view>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel" bindtap="onCancel">取消</button>
      <button class="modal-btn confirm" bindtap="onConfirm">确定</button>
    </view>
  </view>
</view>
