<view class="gamble-result-table">
  <view class="table-wrapper">
    <!-- 表头 -->
    <view class="table-header">
      <view class="header-cell hole-header">
        <text>洞</text>
      </view>
      <view
        class="header-cell player-header"
        wx:for="{{players}}"
        wx:key="user_id"
        wx:for-item="player"
        wx:for-index="index"
      >
        <view class="player-info">
          <PlayerAvatar
            avatar="{{player.cover}}"
            name="{{player.display_name}}"
            userId="{{player.user_id}}"
            size="xs"
            shape="round"
            showTeam="{{false}}"
          />
        </view>
      </view>
    </view>

    <!-- 表格主体 -->
    <view class="table-container">
      <!-- 洞数据行 -->
      <view class="table-body">
        <view class="table-row" wx:for="{{processedHoles}}" wx:key="index">
          <view class="cell hole-header">
            <view class="hole-header-inner">
              <text wx:if="{{item.draw === 'y'}}" title="平局">{{item.holename || item.id}}❓</text>
              <text wx:else>{{item.holename || item.id}}</text>
            </view>
          </view>
          <view
            class="cell"
            wx:for="{{players}}"
            wx:key="user_id"
            wx:for-item="player"
            wx:for-index="index"
          >
            <text
              class="{{item.holeMoney[player.user_id] > 0 ? 'money-positive' : item.holeMoney[player.user_id] < 0 ? 'money-negative' : 'money-zero'}}"
            >{{item.holeMoney[player.user_id] > 0 ? '+' : ''}}{{item.holeMoney[player.user_id]}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 固定在屏幕底部的统计行 -->
  <view class="fixed-summary">
    <view class="table-wrapper">
      <!-- 总计行 -->
      <view class="table-row total-row">
        <view class="cell hole-header">
          <text>总成绩</text>
        </view>
        <view
          class="cell"
          wx:for="{{players}}"
          wx:key="user_id"
          wx:for-item="player"
          wx:for-index="index"
        >
          <text
            class="{{totalMoney[player.user_id] > 0 ? 'money-positive' : totalMoney[player.user_id] < 0 ? 'money-negative' : 'money-zero'}}"
          >{{totalMoney[player.user_id] > 0 ? '+' : ''}}{{totalMoney[player.user_id]}}</text>
        </view>
      </view>

      <!-- 锅汇总行 -->
      <view class="table-row total-row">
        <view class="cell hole-header">
          <text>总锅</text>
        </view>
        <view
          class="cell"
          wx:for="{{players}}"
          wx:key="user_id"
          wx:for-item="player"
          wx:for-index="index"
        >
          <text
            class="{{totalDonated[player.user_id] > 0 ? 'money-positive' : totalDonated[player.user_id] < 0 ? 'money-negative' : 'money-zero'}}"
          >{{totalDonated[player.user_id] > 0 ? '+' : ''}}{{totalDonated[player.user_id]}}</text>
        </view>
      </view>
    </view>
  </view>
</view>
