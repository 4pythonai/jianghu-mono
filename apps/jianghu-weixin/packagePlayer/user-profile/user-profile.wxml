<wxs src="/utils/image.wxs" module="image" />
<view class="page-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <CustomNavBar title="çƒå‹ä¸»é¡µ" showBack="{{true}}" />

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="page-content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{error}}" class="error-container">
      <text class="error-icon">ğŸ˜•</text>
      <text class="error-text">{{error}}</text>
      <button class="retry-btn" bindtap="goBack">è¿”å›</button>
    </view>

    <!-- ç”¨æˆ·èµ„æ–™ -->
    <view wx:else class="profile-content">
      <!-- ç”¨æˆ·å¤´éƒ¨ä¿¡æ¯å¡ç‰‡ -->
      <view class="user-header-card">
        <!-- èƒŒæ™¯è£…é¥° -->
        <view class="header-bg"></view>

        <!-- å¤´åƒåŒºåŸŸ -->
        <view class="avatar-section">
          <image
            class="user-avatar"
            src="{{image.imageUrl(userInfo.avatar) || '/assets/images/default-avatar.png'}}"
            mode="aspectFill"
          />
        </view>

        <!-- ç”¨æˆ·åå’Œæ€§åˆ« -->
        <view class="name-section">
          <text class="user-showname">{{userInfo.show_name}}</text>
          <text wx:if="{{userInfo.gender === 'male'}}" class="gender-badge male">â™‚</text>
          <text wx:elif="{{userInfo.gender === 'female'}}" class="gender-badge female">â™€</text>
        </view>

        <!-- å·®ç‚¹ä¿¡æ¯ -->
        <view class="handicap-section">
          <view class="handicap-item">
            <text class="handicap-label">æ±Ÿæ¹–å·®ç‚¹</text>
            <text class="handicap-value">{{userInfo.handicap || '--'}}</text>
          </view>
          <view class="handicap-divider"></view>
          <view class="handicap-item">
            <text class="handicap-label">æµ®åŠ¨ç³»æ•°</text>
            <text class="handicap-value">{{userInfo.floatCoef || '--'}}</text>
          </view>
        </view>
      </view>

      <!-- ç»Ÿè®¡æ•°æ® -->
      <view class="stats-card">
        <view class="stat-item">
          <text class="stat-value">{{stats.gamesCount}}</text>
          <text class="stat-label">å‚ä¸çƒå±€</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{stats.teamsCount}}</text>
          <text class="stat-label">æ‰€å±çƒé˜Ÿ</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{stats.followers_count}}</text>
          <text class="stat-label">ç²‰ä¸æ•°é‡</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
      <view wx:if="{{!isSelf}}" class="action-section">
        <button
          wx:if="{{!relationship.is_following}}"
          class="action-btn primary"
          bindtap="toggleFollow"
          disabled="{{actionLoading}}"
        >
          <text class="btn-icon">+</text>
          <text>å…³æ³¨</text>
        </button>
        <button
          wx:else
          class="action-btn secondary"
          bindtap="toggleFollow"
          disabled="{{actionLoading}}"
        >
          <text>å–æ¶ˆå…³æ³¨</text>
        </button>
      </view>

      <!-- çƒé˜Ÿåˆ—è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰ -->
      <view wx:if="{{userInfo.teams && userInfo.teams.length > 0}}" class="section-card">
        <view class="section-title">æ‰€å±çƒé˜Ÿ</view>
        <view class="teams-list">
          <view wx:for="{{userInfo.teams}}" wx:key="id" class="team-item">
            <image
              class="team-logo"
              src="{{image.imageUrl(item.logo) || '/assets/images/default-team.png'}}"
              mode="aspectFill"
            />
            <text class="team-name">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
