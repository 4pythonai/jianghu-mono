<wxs src="/utils/image.wxs" module="image" />
<view class="container">
  <CustomNavBar title="é€šè®¯å½•" showBack="{{true}}" rightText="æ·»åŠ çƒå‹" bindrighttap="goToAddFriend" />

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box">
      <image class="search-icon" src="/assets/icons/search.png" mode="aspectFit"></image>
      <input
        class="search-input"
        type="text"
        value="{{searchKeyword}}"
        placeholder="æœç´¢"
        placeholder-class="search-placeholder"
        bindinput="onSearchInput"
      />
      <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="clearSearch">
        <text>æ¸…ç©º</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å…¥å£åŒº -->
  <view class="category-section">
    <!-- çƒé˜Ÿ -->
    <view class="category-item" bindtap="goToTeams">
      <view class="category-icon teams">
        <image src="/assets/icons/icons8-team-48.png" mode="aspectFit"></image>
      </view>
      <view class="category-info">
        <text class="category-name">çƒé˜Ÿ ({{teamsCount}})</text>
      </view>
      <view class="category-arrow">
        <image src="/assets/icons/icons8-right-arrow-48.png" mode="aspectFit"></image>
      </view>
    </view>

    <!-- æˆ‘å…³æ³¨çš„äºº -->
    <view class="category-item" bindtap="goToFollowings">
      <view class="category-icon followings">
        <image src="/assets/icons/icons8-following-48.png" mode="aspectFit"></image>
      </view>
      <view class="category-info">
        <text class="category-name">æˆ‘å…³æ³¨çš„äºº ({{followingsCount}})</text>
      </view>
    </view>

    <!-- æˆ‘çš„ç²‰ä¸ -->
    <view class="category-item" bindtap="goToFollowers">
      <view class="category-icon followers">
        <image src="/assets/icons/icons8-fans-48.png" mode="aspectFit"></image>
      </view>
      <view class="category-info">
        <text class="category-name">æˆ‘çš„ç²‰ä¸ ({{followersCount}})</text>
      </view>
    </view>

    <!-- éæ³¨å†Œå¥½å‹ -->
    <view class="category-item" bindtap="goToGhosts">
      <view class="category-icon ghosts">
        <image src="/assets/icons/icons8-temp-user-48.png" mode="aspectFit"></image>
      </view>
      <view class="category-info">
        <text class="category-name">éæ³¨å†Œå¥½å‹</text>
        <text class="category-hint">(å¯åˆ é™¤)</text>
      </view>
    </view>
  </view>

  <!-- å¥½å‹åˆ—è¡¨ï¼ˆæŒ‰å­—æ¯åˆ†ç»„ï¼‰ -->
  <view class="friends-section">
    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- å¥½å‹åˆ—è¡¨ -->
    <block wx:elif="{{groupedFriends.length > 0}}">
      <view
        wx:for="{{groupedFriends}}"
        wx:for-item="group"
        wx:for-index="groupIndex"
        wx:key="letter"
        class="letter-group"
        id="group-{{group.letter === '#' ? 'hash' : group.letter}}"
      >
        <!-- å­—æ¯æ ‡é¢˜ -->
        <view class="letter-header">
          <text class="letter-text">{{group.letter}}</text>
        </view>
        <!-- è¯¥å­—æ¯ä¸‹çš„å¥½å‹ -->
        <view
          wx:for="{{group.friends}}"
          wx:for-item="friend"
          wx:for-index="friendIndex"
          wx:key="userid"
          class="friend-item"
          data-friend="{{friend}}"
          bindtap="goToUserProfile"
        >
          <view class="friend-content">
            <view class="friend-avatar-wrap">
              <PlayerAvatar
                avatar="{{image.imageUrl(friend.avatar)}}"
                userId="{{friend.userid}}"
                avatarOnly="{{true}}"
                size="small"
                clickable="{{false}}"
              />
            </view>
            <view class="friend-info">
              <view class="friend-name-row">
                <text class="friend-name">{{friend.nickname || 'æœªçŸ¥å¥½å‹'}}</text>
                <text class="gender-icon male" wx:if="{{friend.gender === 'male'}}">â™‚</text>
                <text class="gender-icon female" wx:if="{{friend.gender === 'female'}}">â™€</text>
              </view>
              <text
                class="friend-handicap"
                wx:if="{{friend.handicap !== null && friend.handicap !== undefined}}"
              >æ±Ÿæ¹–å·®ç‚¹: {{friend.handicap}}</text>
              <text class="friend-signature" wx:if="{{friend.signature}}">{{friend.signature}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <text class="empty-text">æš‚æ— å¥½å‹</text>
      <text class="empty-desc">å…³æ³¨å¹¶è¢«å¯¹æ–¹å…³æ³¨åæˆä¸ºå¥½å‹</text>
    </view>
  </view>

  <!-- å­—æ¯ç´¢å¼•æ  -->
  <view wx:if="{{indexList.length > 0}}" class="index-bar" catchtouchmove="onIndexTouchMove">
    <view
      wx:for="{{indexList}}"
      wx:key="*this"
      class="index-item {{currentLetter === item ? 'active' : ''}}"
      data-letter="{{item}}"
      bindtap="onIndexTap"
    >
      <text>{{item}}</text>
    </view>
  </view>

  <!-- å­—æ¯æç¤ºæ°”æ³¡ -->
  <view wx:if="{{showLetterToast}}" class="letter-toast">
    <text>{{currentLetter}}</text>
  </view>
</view>
