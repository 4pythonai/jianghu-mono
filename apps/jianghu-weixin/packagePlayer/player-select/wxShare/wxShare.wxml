<wxs src="/utils/image.wxs" module="image" />
<CustomNavBar title="邀请好友" />
<view class="container">
  <view class="invite-card">
    <view class="card-header">
      <text class="card-title">INVITED JOIN GAME</text>
    </view>
    <view class="code-section">
      <view class="section-top">
        <text class="section-label">[比赛编号]</text>
        <button class="ghost-btn" bindtap="handleCopyInvite" wx:if="{{uuid}}">复制</button>
      </view>
      <text class="code-value">{{gameid || '暂未获取邀请码'}}</text>
    </view>

    <view class="result-section" wx:if="{{joinSuccess}}">
      <text class="result-text">已成功加入比赛</text>
    </view>
    <view class="error-section" wx:if="{{joinError}}">
      <text class="error-text">{{joinError}}</text>
    </view>
    <!-- 已报名组信息 -->
    <view class="groups-section" wx:if="{{groups && groups.length > 0}}">
      <text class="groups-title">已报名组别</text>
      <view class="group-list">
        <view class="group-item" wx:for="{{groups}}" wx:key="groupid">
          <view class="group-header">
            <text class="group-name">{{item.group_name}}</text>
            <text class="group-count">{{item.user_count}}人已加入</text>
          </view>
          <view class="user-list">
            <view class="user-item" wx:for="{{item.users}}" wx:key="user_id" wx:for-item="user">
              <image
                class="user-avatar"
                src="{{image.imageUrl(user.avatar) || '/images/default-avatar.png'}}"
                mode="aspectFill"
              ></image>
              <text class="user-name">{{user.show_name}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <view class="tips-card">
    <text class="tips-title">使用说明</text>
    <view class="tips-item">
      <text>1. 点击右上角"..."可转发到好友或群聊。</text>
    </view>
    <view class="tips-item">
      <text>2. 好友进入后可直接加入比赛或复制邀请码给组织者安排分组。</text>
    </view>
    <view class="tips-item">
      <text>3. 若无法打开小程序，可保存二维码或复制邀请码稍后再次加入。</text>
    </view>
  </view>
</view>

<!-- 全屏模糊遮罩 + 浮动按钮 -->
<view class="floating-overlay" wx:if="{{uuid}}">
  <view class="blur-backdrop"></view>
  <view class="floating-actions">
    <!-- 围观比赛 -->
    <view class="action-card watch-card" bindtap="handleWatch">
      <text class="action-card-title">围观比赛</text>
      <image class="action-card-icon" src="/assets/icons/icons8-eye-48.png" mode="aspectFit"></image>
    </view>
    <!-- 加入比赛 -->
    <view class="action-card join-card {{joinSuccess ? 'disabled' : ''}}" bindtap="handleJoin">
      <text class="action-card-title">{{joinSuccess ? '已加入' : '加入比赛'}}</text>
      <image class="action-card-icon" src="/assets/icons/icons8-add-48.png" mode="aspectFit"></image>
    </view>
  </view>
</view>
