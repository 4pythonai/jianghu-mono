<wxs src="/utils/image.wxs" module="image" />
<CustomNavBar title="添加球员" />
<view class="page-container">
  <view class="content">
    <!-- 顶部装饰圆形 -->
    <view class="top-circle">
      <image class="top-circle-icon" src="/assets/icons/icons8-add-48.png" mode="aspectFit"></image>
    </view>

    <!-- 此组已添加球员列表 -->
    <attened-players />

    <!-- 二维码区域 -->
    <view class="qrcode-section">
      <!-- 加载中 -->
      <view wx:if="{{loading}}" class="qrcode-status loading">
        <text class="status-text">正在生成二维码...</text>
      </view>

      <!-- 错误状态 -->
      <view wx:elif="{{error}}" class="qrcode-status error">
        <text class="error-text">{{error}}</text>
        <view class="retry-btn" bindtap="handleRetry">
          <text class="retry-text">重新生成</text>
        </view>
      </view>

      <!-- 二维码展示 -->
      <view wx:elif="{{qrcodeUrl}}" class="qrcode-display">
        <image
          class="qrcode-image"
          src="{{image.imageUrl(qrcodeUrl)}}"
          mode="aspectFit"
          show-menu-by-longpress="true"
        ></image>
        <text class="qrcode-hint">现场球友扫描后即可加入比赛</text>
        <text class="qrcode-tip">长按二维码可保存或转发</text>
      </view>

      <!-- 未生成状态 - 没有uuid -->
      <view wx:else class="qrcode-status placeholder">
        <text class="status-text">{{uuid ? '等待生成二维码...' : '二维码功能暂不可用'}}</text>
        <text wx:if="{{!uuid}}" class="qrcode-tip">请使用下方其他方式添加球员</text>
      </view>
    </view>

    <!-- 其他添加方式提示 -->
    <view class="other-methods-hint">
      <view class="divider-line"></view>
      <text class="hint-text">或选择其他添加方式</text>
      <view class="divider-line"></view>
    </view>

    <!-- 底部操作按钮 -->
    <view class="action-buttons">
      <view class="action-btn manual-add-btn" bindtap="handleManualAdd">
        <image class="btn-icon" src="/assets/icons/icons8-hand-with-pen-48.png" mode="aspectFit"></image>
        <text class="btn-text">手工添加</text>
      </view>
      <view class="action-btn friend-select-btn" bindtap="handleFriendSelect">
        <image class="btn-icon" src="/assets/icons/icons8-friends-48.png" mode="aspectFit"></image>
        <text class="btn-text">好友选择</text>
      </view>
    </view>
  </view>
</view>
