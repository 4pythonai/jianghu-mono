# 赌博游戏运行时配置功能说明

## 项目结构

我们创建了目录:
```
/Users/alex/codebase/golf/brother-new/miniprogram/pages/gambleRuntimeConfig/RuntimeComponents
```

## 功能概述

`gambleRuntimeConfig` 是添加赌博规则后的运行时配置页面，用于在选择赌博规则后进行具体的游戏参数配置。

## 组件架构

### 主页面
- **页面路径**: `pages/gambleRuntimeConfig/gambleRuntimeConfig`
- **功能**: 运行时配置的主页面，整合所有配置组件

### RuntimeComponents 下的公共组件

#### 1. Summary组件
- **路径**: `RuntimeComponents/Summary/Summary`
- **功能**: 显示用户选择的赌博规则，参与的人员列表
- **特性**: 
  - 显示规则类型和参与人数
  - 支持点击重新选择赌博规则
  - 展示所有参与玩家的头像和昵称

#### 2. HoleRangeSelector组件(起点洞与终止洞选择组件)
- **路径**: `RuntimeComponents/HoleRangeSelector/HoleRangeSelector`
- **功能**: 选择游戏进行的洞数范围
- **特性**:
  - 支持自定义起始洞和结束洞
  - 直观的选择器界面
  - 实时显示当前选择的洞数范围

#### 3. RedBlueConfig组件(分组组件)
- **路径**: `RuntimeComponents/RedBlueConfig/RedBlueConfig`
- **功能**: 3人游戏或者4人游戏，需要分出红蓝组，进行对抗
- **特性**:
  - 支持将玩家分配到红队或蓝队
  - 提供自动分组和手动分组功能
  - 支持重置分组配置
  - 直观的拖拽式分组界面

#### 4. RankingSelector组件(排名组件)
- **路径**: `RuntimeComponents/RankingSelector/RankingSelector`
- **功能**: 某些游戏红蓝组人员分配，与上一洞的成绩/得分相关
- **特性**:
  - 支持多种排名算法：基于得分、基于差点、随机排名、基于上一洞表现
  - 单选按钮界面，易于选择
  - 配置项：`ranking_tie_resolve_config`

## 数据流向

### 完整流程
1. **起点**: `pages/gameDetail/gameDetail` 点击"添加游戏"
2. **规则选择**: 跳转到 `pages/rules/rules` 第一个TAB(用户赌博规则)
3. **运行时配置**: 点击规则卡片后跳转到 `pages/gambleRuntimeConfig` 进行配置
4. **返回**: 配置完成后返回到 `pages/gameDetail/gameDetail`

### 数据传递
- **传入数据**: 从 `gameStore` 获取游戏数据、玩家信息、洞数信息
- **配置数据**: 
  - `runtimeConfig.firstHoleindex` - 起始洞
  - `runtimeConfig.lastHoleindex` - 结束洞
  - `runtimeConfig.red_blue_config` - 红蓝分组配置
  - `runtimeConfig.ranking_tie_resolve_config` - 排名配置

## 配置字段说明

### 红蓝分组配置 (`red_blue_config`)
```javascript
{
  enable: false,          // 是否启用红蓝分组
  redTeam: [],           // 红队玩家列表
  blueTeam: []           // 蓝队玩家列表
}
```


## 技术特点

1. **组件化开发** - 每个功能模块独立封装，便于维护和复用
2. **数据绑定** - 完整的数据传递和事件机制
3. **响应式设计** - 支持不同设备尺寸的适配
4. **用户体验** - 现代化UI设计，清晰的操作流程
5. **数据验证** - 完整的配置验证和错误处理机制

## 使用示例

### 页面跳转
```javascript
// 从AddRule组件跳转到运行时配置
wx.navigateTo({
  url: `/pages/gambleRuntimeConfig/gambleRuntimeConfig?data=${encodedData}`
});
```

### 组件使用
```xml
<!-- 在运行时配置页面中使用组件 -->
<Summary 
  ruleType="{{ruleType}}"
  players="{{players}}"
  bind:reselect="onReSelectRule"
/>

<HoleRangeSelector 
  firstHoleindex="{{runtimeConfig.firstHoleindex}}"
  lastHoleindex="{{runtimeConfig.lastHoleindex}}"
  totalHoles="{{holes.length}}"
  bind:change="onHoleRangeChange"
/>

<RedBlueConfig 
  players="{{players}}"
  redTeam="{{runtimeConfig.red_blue_config.redTeam}}"
  blueTeam="{{runtimeConfig.red_blue_config.blueTeam}}"
  bind:change="onRedBlueConfigChange"
/>

<RankingSelector 
  selectedConfig="{{runtimeConfig.ranking_tie_resolve_config}}"
  bind:change="onRankingConfigChange"
/>
```

## 实现完成状态

✅ **主页面创建完成**
- gambleRuntimeConfig.js
- gambleRuntimeConfig.json  
- gambleRuntimeConfig.wxml
- gambleRuntimeConfig.wxss

✅ **Summary组件完成**
- Summary.js, Summary.json, Summary.wxml, Summary.wxss

✅ **HoleRangeSelector组件完成**
- HoleRangeSelector.js, HoleRangeSelector.json, HoleRangeSelector.wxml, HoleRangeSelector.wxss

✅ **RedBlueConfig组件完成**
- RedBlueConfig.js, RedBlueConfig.json, RedBlueConfig.wxml, RedBlueConfig.wxss

✅ **RankingSelector组件完成**
- RankingSelector.js, RankingSelector.json, RankingSelector.wxml, RankingSelector.wxss

✅ **跳转逻辑修改完成**
- 修改了AddRule组件的onConfigRule方法

✅ **README.md更新完成**
- 添加了新功能的详细说明