<view class="gamble-result-table">
  <view class="table-container">
    <!-- 表头 -->
    <view class="table-header">
      <view class="header-cell hole-header">
        <text>洞</text>
      </view>
      <view
        class="header-cell player-header"
        wx:for="{{players}}"
        wx:key="userid"
        wx:for-item="player"
        wx:for-index="userid"
      >
        <view class="player-info">
          <image
            wx:if="{{player.cover}}"
            class="player-avatar"
            src="{{player.cover}}"
            mode="aspectFill"
          ></image>
          <view class="player-name">{{player.nickname}}</view>
        </view>
      </view>
    </view>

    <!-- 洞数据行 -->
    <view class="table-body">
      <view class="table-row" wx:for="{{processedHoles}}" wx:key="index">
        <view class="cell hole-header">
          <view class="hole-header-inner">
            <text wx:if="{{item.draw === 'y'}}" title="平局">{{item.holename || item.id}}❓</text>
            <text wx:else>{{item.holename || item.id}}</text>
          </view>
        </view>
        <view
          class="cell {{item.red && item.red.includes(userid) ? 'team-red' : ''}} {{item.blue && item.blue.includes(userid) ? 'team-blue' : ''}}"
          wx:for="{{players}}"
          wx:key="userid"
          wx:for-item="player"
          wx:for-index="userid"
        >
          <text
            class="{{item.holeMoney[userid] > 0 ? 'money-positive' : item.holeMoney[userid] < 0 ? 'money-negative' : 'money-zero'}}"
          >{{item.holeMoney[userid] > 0 ? '+' : ''}}{{item.holeMoney[userid]}}</text>
        </view>
      </view>
    </view>

    <!-- 总计行 -->
    <view class="table-row total-row">
      <view class="cell hole-header">
        <text>总成绩</text>
      </view>
      <view
        class="cell"
        wx:for="{{players}}"
        wx:key="userid"
        wx:for-item="player"
        wx:for-index="userid"
      >
        <text
          class="{{totalMoney[userid] > 0 ? 'money-positive' : totalMoney[userid] < 0 ? 'money-negative' : 'money-zero'}}"
        >{{totalMoney[userid] > 0 ? '+' : ''}}{{totalMoney[userid]}}</text>
      </view>
    </view>

    <!-- 锅汇总行 -->
    <view class="table-row total-row">
      <view class="cell hole-header">
        <text>总锅</text>
      </view>
      <view
        class="cell"
        wx:for="{{players}}"
        wx:key="userid"
        wx:for-item="player"
        wx:for-index="userid"
      >
        <text
          class="{{totalDonated[userid] > 0 ? 'money-positive' : totalDonated[userid] < 0 ? 'money-negative' : 'money-zero'}}"
        >{{totalDonated[userid] > 0 ? '+' : ''}}{{totalDonated[userid]}}</text>
      </view>
    </view>
  </view>
</view>
