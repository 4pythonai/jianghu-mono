# 高尔夫小程序项目

这是一个微信小程序，关于高尔夫运动的，包括计费、游戏、群组等功能。

## 主要功能

### 用户管理
- ✅ 微信登录和用户身份验证
- ✅ 用户头像和昵称获取（已更新为新版API）
- ✅ 手机号绑定功能
- ✅ 用户信息管理
- ✅ 头像本地存储功能

### 核心功能
- 🚧 高尔夫计费系统
- 🚧 游戏功能
- 🚧 群组管理
- 🚧 其他功能开发中...

## 最近更新

### 2024-12-19 - 头像存储机制优化
- **问题解决**: 修复了开发者工具中 `chooseAvatar` 临时文件系统错误
- **新增功能**:
  - 头像本地永久存储：将临时头像文件保存到小程序本地存储
  - 头像缓存机制：重启小程序后自动加载已保存的头像
  - 文件系统容错：处理文件不存在或存储失败的情况
- **技术改进**:
  - 使用 `wx.getFileSystemManager()` 进行文件操作
  - 添加完整的错误处理和降级方案
  - 实现头像文件的生命周期管理

### 2024-12-19 - 用户信息获取功能升级
- **问题修复**: 修复了 `getUserProfile` API 废弃导致无法获取用户信息的问题
- **功能更新**: 
  - 使用新的 `open-type="chooseAvatar"` 方式获取用户头像
  - 使用 `type="nickname"` 输入框获取用户昵称
  - 优化用户体验，提供更直观的信息完善界面
- **技术改进**:
  - 移除废弃的 `wx.getUserProfile` API
  - 增加头像预览功能
  - 添加昵称输入验证
  - 改进UI界面和交互体验

## 技术特性

### 头像存储机制
```javascript
// 头像文件存储路径
USER_DATA_PATH/avatar_[timestamp].jpg

// 存储流程
1. 用户选择头像 → 微信提供临时文件路径
2. 使用 fs.saveFile() 保存到本地永久存储
3. 将文件路径保存到 localStorage
4. 页面重新加载时自动恢复用户头像
```

### 容错机制
- **文件系统错误**: 自动降级使用临时路径
- **文件丢失**: 自动清理无效缓存，使用默认头像
- **存储失败**: 提供友好的用户提示，不影响基本功能

## 开发说明

### 技术栈
- 微信小程序原生框架
- JavaScript ES6+
- WXSS样式
- 微信小程序API
- 小程序文件系统 API

### 项目结构
- `pages/mine/` - 个人中心页面
- `api/` - API接口管理
- `components/` - 自定义组件
- `utils/` - 工具函数
- `images/` - 图片资源
  - `default-avatar.png` - 默认用户头像

## 注意事项

1. **用户信息获取**: 现已使用微信官方推荐的新方式获取用户头像和昵称
2. **头像存储**: 实现了本地永久存储，避免临时文件丢失问题
3. **兼容性**: 确保小程序基础库版本支持新的API
4. **开发者工具**: chooseAvatar 在开发者工具中可能有文件系统问题，真机测试正常
5. **用户体验**: 提供清晰的授权引导和信息完善流程